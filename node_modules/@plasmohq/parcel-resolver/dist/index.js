var B=Object.create;var h=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var K=Object.getPrototypeOf,U=Object.prototype.hasOwnProperty;var X=(t,e)=>{for(var o in e)h(t,o,{get:e[o],enumerable:!0})},P=(t,e,o,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of H(e))!U.call(t,s)&&s!==o&&h(t,s,{get:()=>e[s],enumerable:!(n=G(e,s))||n.enumerable});return t};var w=(t,e,o)=>(o=t!=null?B(K(t)):{},P(e||!t||!t.__esModule?h(o,"default",{value:t,enumerable:!0}):o,t)),q=t=>P(h({},"__esModule",{value:!0}),t);var nt={};X(nt,{default:()=>st});module.exports=q(nt);var z=require("@parcel/plugin");var c=require("path");var D=w(require("fast-glob")),F=require("fs"),L=require("fs-extra"),a=require("path");var v=typeof globalThis.process<"u"?globalThis.process.argv:[];var R=()=>typeof globalThis.process<"u"?globalThis.process.env:{},Q=/\$([\w+]+)/gm,E=(t,e=R(),o=Q)=>t.replace(o,(n,s)=>e[s]||n);var Y=new Set(v),S=t=>Y.has(t),mt=v.filter(t=>t.startsWith("--")&&t.includes("=")).map(t=>t.split("=")).reduce((t,[e,o])=>(t[e]=o,t),{});var ut=S("--dry-run"),x=()=>S("--verbose")||R().VERBOSE==="true",ft=x();var Z=(t="",...e)=>console.log(t.padEnd(9),"|",...e);var tt=0,f=(...t)=>x()&&Z(`\u{1F7E1} ${tt++}`,...t);var p=require("path"),b=t=>t.replaceAll(p.win32.sep,p.posix.sep);var l=[".ts",".tsx",".svelte",".vue",".json"],M=new Set(l),r={got:null,dotPlasmoDirectory:null,remoteCacheDirectory:null,polyfillMap:null,aliasMap:null},C=async t=>{if(r.got===null&&(r.got=(await import("got")).default),r.dotPlasmoDirectory||(r.dotPlasmoDirectory=(0,a.resolve)(process.env.PLASMO_PROJECT_DIR,".plasmo")),r.remoteCacheDirectory||(r.remoteCacheDirectory=(0,a.resolve)(r.dotPlasmoDirectory,"cache","remote-code"),await t.options.inputFS.exists(r.remoteCacheDirectory)||(f("Reinitializing remote cache directory"),await t.options.inputFS.mkdirp(r.remoteCacheDirectory))),!r.polyfillMap){let e=(0,a.join)(__dirname,"polyfills"),o=await(0,D.default)("**/*.js",{cwd:e,onlyFiles:!0});r.polyfillMap=new Map(o.map(n=>[b(n.slice(0,-3)),(0,a.join)(e,n)]))}if(!r.aliasMap){let e=await(0,L.readJson)((0,a.resolve)(process.env.PLASMO_PROJECT_DIR,"package.json"));r.aliasMap=new Map(Object.entries(e.alias||{}))}},m=async(t,e=l,o={})=>{let n=e.flatMap(s=>[`${t}${s}`,(0,a.resolve)(t,`index${s}`)]);for(let s of n)try{if((0,F.statSync)(s).isFile())return{filePath:s,...o}}catch{}return null};async function A({specifier:t,dependency:e}){if(t[0]!=="/"||(0,c.isAbsolute)(t))return null;let o=(0,c.resolve)(process.env.PLASMO_PROJECT_DIR,t.slice(1));if((0,c.extname)(o).length>0)return{filePath:o};let s=(0,c.extname)(e.resolveFrom),i=[s,...l.filter(u=>u!==s)];return m(o,i)}var T=require("path");var O=require("fs"),g=require("fs/promises");async function et(t,e){try{return await(0,g.access)(t,e),!0}catch{return!1}}async function _(t){return et(t,O.constants.R_OK)}async function $({specifier:t}){if(!r.aliasMap.has(t))return null;let e=(0,T.resolve)(r.aliasMap.get(t));return await _(e)?{filePath:e,priority:"sync"}:null}var d=require("path");var ot=(t="",e="",o="")=>{if(!t.startsWith(e))return null;let[n,s]=t.split(e);return m((0,d.resolve)(o,s))};async function k({specifier:t}){return ot(t,"@plasmo-static-common/",(0,d.resolve)(r.dotPlasmoDirectory,"static","common"))}async function I({specifier:t}){return r.polyfillMap.has(t)?{filePath:r.polyfillMap.get(t),priority:"sync"}:null}var W=require("@parcel/hash"),j=require("path");var rt=async(t,e)=>t.origin==="https://www.googletagmanager.com"?e.replace(/http:/g,"chrome-extension:"):e;async function N({specifier:t,dependency:e,options:o}){if(!t.startsWith("https://")||!l.some(i=>e.sourcePath.endsWith(i)))return null;let n=new URL(E(t)),s=n.searchParams.get("plasmo-ext")||"js";try{let i=(0,j.resolve)(r.remoteCacheDirectory,`${(0,W.hashString)(t)}.${s}`),u=await r.got(n.toString()).text(),V=await rt(n,u);return await o.inputFS.rimraf(i),await o.inputFS.writeFile(i,V,{mode:436}),f(`Caching HTTPS dependency: ${t}`),{priority:"lazy",sideEffects:!0,filePath:i}}catch(i){return{diagnostics:[{message:`Cannot download the resource from ${t}`,hints:[i.message]}]}}}var y=require("path");async function J({specifier:t,dependency:e}){if(t[0]!=="~")return null;let o=(0,y.resolve)(process.env.PLASMO_SRC_DIR,t.slice(1)),n=(0,y.extname)(o);if(n.length>0&&M.has(n))return{filePath:o};let s=(0,y.extname)(e.resolveFrom),i=[s,...l.filter(u=>u!==s)];return m(o,i)}var st=new z.Resolver({async resolve(t){return await C(t),await $(t)||await k(t)||await I(t)||await N(t)||await J(t)||await A(t)||null}});
