#!/usr/bin/env node
import { createRequire } from 'module';const require = createRequire(import.meta.url);
var cu=Object.create;var on=Object.defineProperty;var lu=Object.getOwnPropertyDescriptor;var uu=Object.getOwnPropertyNames;var fu=Object.getPrototypeOf,pu=Object.prototype.hasOwnProperty;var v=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var y=(t,e)=>()=>(t&&(e=t(t=0)),e);var w=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ke=(t,e)=>{for(var r in e)on(t,r,{get:e[r],enumerable:!0})},mu=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of uu(e))!pu.call(t,i)&&i!==r&&on(t,i,{get:()=>e[i],enumerable:!(n=lu(e,i))||n.enumerable});return t};var A=(t,e,r)=>(r=t!=null?cu(fu(t)):{},mu(e||!t||!t.__esModule?on(r,"default",{value:t,enumerable:!0}):r,t));var ot,tr,rr=y(()=>{ot=typeof globalThis.process<"u"?globalThis.process.argv:[],tr=(t=ot[2])=>ot.filter(e=>!e.startsWith("--")).slice(ot.indexOf(t)+1)});var sn,du,ji,an=y(()=>{sn=()=>typeof globalThis.process<"u"?globalThis.process.env:{},du=/\$([\w+]+)/gm,ji=(t,e=sn(),r=du)=>t.replace(r,(n,i)=>e[i]||n)});var hu,$,gu,H,Kg,kt,Ui,pe=y(()=>{rr();an();hu=new Set(ot),$=t=>hu.has(t),gu=ot.filter(t=>t.startsWith("--")&&t.includes("=")).map(t=>t.split("=")).reduce((t,[e,r])=>(t[e]=r,t),{}),H=t=>gu[t],Kg=$("--dry-run"),kt=()=>$("--verbose")||sn().VERBOSE==="true",Ui=kt()});var ve,qi,De,le,M,Z,yu,d,b=y(()=>{pe();ve=(t="",...e)=>console.log(t.padEnd(9),"|",...e),qi=(...t)=>ve("",...t),De=(...t)=>ve("\u{1F7E2} DONE",...t),le=(...t)=>console.error("\u{1F534} ERROR".padEnd(9),"|",...t),M=(...t)=>ve("\u{1F535} INFO",...t),Z=(...t)=>ve("\u{1F7E0} WARN",...t),yu=0,d=(...t)=>kt()&&ve(`\u{1F7E1} ${yu++}`,...t)});import{paramCase as wu}from"change-case";var Fe,Hi,st=y(()=>{pe();Fe=()=>{let t=H("--src-path")||process.env.PLASMO_SRC_PATH||"src",e=H("--build-path")||process.env.PLASMO_BUILD_PATH||"build",r=H("--tag")||process.env.PLASMO_TAG||(process.env.NODE_ENV==="production"?"prod":"dev"),n=wu(H("--target")||process.env.PLASMO_TARGET||"chrome-mv3"),[i,o]=n.split("-"),s=H("--entry")||"popup",a=H("--env");return{browser:i,manifestVersion:o,tag:r,srcPath:t,buildPath:e,target:n,entry:s,envPath:a}},Hi=`
    
    init

      --entry                     entry files (default: popup)
      --with-<name>               use an example template

    dev/build     

      --target [string]           set the target (default: chrome-mv3)
      --tag [string]              set the build tag (default: dev or prod depending on NODE_ENV)
      --src-path [path]           set the source path relative to project root (default: src)
      --build-path [path]         set the build path relative to project root (default: build)
      --entry                     entry point name (default: popup)
      --env                       relative path to top-level env file
`});var ue,nr,Xe=y(()=>{b();ln();st();ue=()=>{console.log("\u{1F7E3} Plasmo v0.83.0"),console.log("\u{1F534} The Browser Extension Framework")},nr=()=>{ve("\u{1F7E0} CMDS",cn.join(" | ")),ve("\u{1F7E1} OPTS",Hi)}});var Gi={};Ke(Gi,{default:()=>xu});async function vu(){ue(),nr()}var xu,Ji=y(()=>{Xe();xu=vu});var zi={};Ke(zi,{default:()=>Eu});async function Su(){M("Start the extension development...")}var Eu,Yi=y(()=>{b();Eu=Su});import{constants as un}from"fs";import{access as Pu,mkdir as bu,readdir as ku,stat as Ki}from"fs/promises";async function fn(t,e){try{return await Pu(t,e),!0}catch{return!1}}async function ir(t){return fn(t,un.W_OK)}async function or(t){return fn(t,un.R_OK)}async function F(t){return fn(t,un.F_OK)}async function Xi(t){try{return(await Ki(t)).isDirectory()}catch{return!1}}async function sr(t){try{return(await Ki(t)).isFile()}catch{return!1}}async function Ou(t){let e=(await ku(t,{withFileTypes:!0})).filter(r=>!Cu.has(r.name)).filter(r=>!/\.iml$/.test(r.name));if(e.length>0){d(`Found conflicting contents in ${t}`);let r=e.reduce((n,i)=>`${n}
	${i.name}${i.isDirectory()?"/":""}`,"");return d(r),!1}return!0}async function Qi(t){if(!await ir(t))d("Directory does not exist, creating..."),await bu(t);else{if(d("Directory exists, checking if it is empty..."),!await Ou(t))throw new Error(`Directory ${t} is not empty.`);if(d("Checking if directory is writable..."),!await ir(t))throw new Error(`Directory ${t} is not accesible.`)}}var Cu,Y=y(()=>{b();Cu=new Set([".DS_Store",".git",".gitattributes",".gitignore",".gitlab-ci.yml",".hg",".hgcheck",".hgignore",".idea",".npmignore",".travis.yml","LICENSE","Thumbs.db","docs","mkdocs.yml","npm-debug.log","yarn-debug.log","yarn-error.log",".pnpm-debug.log"])});import{existsSync as Lu}from"fs";import{basename as Nu,resolve as fe}from"path";import{cwd as Tu}from"process";var at,ar=y(()=>{st();at=(t=Tu())=>{let e=Fe();process.env.PLASMO_PROJECT_DIR=t;let r=Nu(t);process.env.PLASMO_SRC_PATH=e.srcPath;let n=fe(t,e.srcPath);process.env.PLASMO_SRC_DIR=Lu(n)?n:t,process.env.PLASMO_BUILD_PATH=e.buildPath;let i=fe(t,e.buildPath);process.env.PLASMO_BUILD_DIR=i;let o=`${e.target}-${e.tag}`,s=fe(i,o),a=fe(t,".plasmo"),l=fe(a,"cache");return{packageName:r,projectDirectory:t,buildDirectory:i,distDirectory:s,distDirectoryName:o,sourceDirectory:process.env.PLASMO_SRC_DIR,packageFilePath:fe(t,"package.json"),gitIgnorePath:fe(t,".gitignore"),assetsDirectory:fe(t,"assets"),dotPlasmoDirectory:a,cacheDirectory:l,plasmoVersionFilePath:fe(l,"plasmo.version.json"),staticDirectory:fe(a,"static"),genAssetsDirectory:fe(a,"gen-assets"),entryManifestPath:fe(a,`${e.target}.plasmo.manifest.json`)}}});import Mu from"@expo/spawn-async";import Iu from"semver";async function pn(t){let e=await Mu(t,["--version"]),r=Iu.valid(e.stdout.trim())||void 0;return{name:t,version:r}}async function ct(){try{let t=process.env.npm_config_user_agent;if(t){if(t.startsWith("yarn"))return{name:"yarn"};if(t.startsWith("pnpm"))return{name:"pnpm"}}try{return await pn("pnpm")}catch{return await pn("yarn")}}catch{return await pn("npm")}}var cr=y(()=>{});var ee=w(mn=>{"use strict";mn.fromCallback=function(t){return Object.defineProperty(function(...e){if(typeof e[e.length-1]=="function")t.apply(this,e);else return new Promise((r,n)=>{t.call(this,...e,(i,o)=>i!=null?n(i):r(o))})},"name",{value:t.name})};mn.fromPromise=function(t){return Object.defineProperty(function(...e){let r=e[e.length-1];if(typeof r!="function")return t.apply(this,e);t.apply(this,e.slice(0,-1)).then(n=>r(null,n),r)},"name",{value:t.name})}});var eo=w((by,Zi)=>{var Ae=v("constants"),Du=process.cwd,lr=null,Fu=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return lr||(lr=Du.call(process)),lr};try{process.cwd()}catch{}typeof process.chdir=="function"&&(dn=process.chdir,process.chdir=function(t){lr=null,dn.call(process,t)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,dn));var dn;Zi.exports=Au;function Au(t){Ae.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&e(t),t.lutimes||r(t),t.chown=o(t.chown),t.fchown=o(t.fchown),t.lchown=o(t.lchown),t.chmod=n(t.chmod),t.fchmod=n(t.fchmod),t.lchmod=n(t.lchmod),t.chownSync=s(t.chownSync),t.fchownSync=s(t.fchownSync),t.lchownSync=s(t.lchownSync),t.chmodSync=i(t.chmodSync),t.fchmodSync=i(t.fchmodSync),t.lchmodSync=i(t.lchmodSync),t.stat=a(t.stat),t.fstat=a(t.fstat),t.lstat=a(t.lstat),t.statSync=l(t.statSync),t.fstatSync=l(t.fstatSync),t.lstatSync=l(t.lstatSync),t.chmod&&!t.lchmod&&(t.lchmod=function(c,f,p){p&&process.nextTick(p)},t.lchmodSync=function(){}),t.chown&&!t.lchown&&(t.lchown=function(c,f,p,m){m&&process.nextTick(m)},t.lchownSync=function(){}),Fu==="win32"&&(t.rename=typeof t.rename!="function"?t.rename:function(c){function f(p,m,h){var g=Date.now(),_=0;c(p,m,function S(C){if(C&&(C.code==="EACCES"||C.code==="EPERM"||C.code==="EBUSY")&&Date.now()-g<6e4){setTimeout(function(){t.stat(m,function(O,W){O&&O.code==="ENOENT"?c(p,m,S):h(C)})},_),_<100&&(_+=10);return}h&&h(C)})}return Object.setPrototypeOf&&Object.setPrototypeOf(f,c),f}(t.rename)),t.read=typeof t.read!="function"?t.read:function(c){function f(p,m,h,g,_,S){var C;if(S&&typeof S=="function"){var O=0;C=function(W,Ie,be){if(W&&W.code==="EAGAIN"&&O<10)return O++,c.call(t,p,m,h,g,_,C);S.apply(this,arguments)}}return c.call(t,p,m,h,g,_,C)}return Object.setPrototypeOf&&Object.setPrototypeOf(f,c),f}(t.read),t.readSync=typeof t.readSync!="function"?t.readSync:function(c){return function(f,p,m,h,g){for(var _=0;;)try{return c.call(t,f,p,m,h,g)}catch(S){if(S.code==="EAGAIN"&&_<10){_++;continue}throw S}}}(t.readSync);function e(c){c.lchmod=function(f,p,m){c.open(f,Ae.O_WRONLY|Ae.O_SYMLINK,p,function(h,g){if(h){m&&m(h);return}c.fchmod(g,p,function(_){c.close(g,function(S){m&&m(_||S)})})})},c.lchmodSync=function(f,p){var m=c.openSync(f,Ae.O_WRONLY|Ae.O_SYMLINK,p),h=!0,g;try{g=c.fchmodSync(m,p),h=!1}finally{if(h)try{c.closeSync(m)}catch{}else c.closeSync(m)}return g}}function r(c){Ae.hasOwnProperty("O_SYMLINK")&&c.futimes?(c.lutimes=function(f,p,m,h){c.open(f,Ae.O_SYMLINK,function(g,_){if(g){h&&h(g);return}c.futimes(_,p,m,function(S){c.close(_,function(C){h&&h(S||C)})})})},c.lutimesSync=function(f,p,m){var h=c.openSync(f,Ae.O_SYMLINK),g,_=!0;try{g=c.futimesSync(h,p,m),_=!1}finally{if(_)try{c.closeSync(h)}catch{}else c.closeSync(h)}return g}):c.futimes&&(c.lutimes=function(f,p,m,h){h&&process.nextTick(h)},c.lutimesSync=function(){})}function n(c){return c&&function(f,p,m){return c.call(t,f,p,function(h){u(h)&&(h=null),m&&m.apply(this,arguments)})}}function i(c){return c&&function(f,p){try{return c.call(t,f,p)}catch(m){if(!u(m))throw m}}}function o(c){return c&&function(f,p,m,h){return c.call(t,f,p,m,function(g){u(g)&&(g=null),h&&h.apply(this,arguments)})}}function s(c){return c&&function(f,p,m){try{return c.call(t,f,p,m)}catch(h){if(!u(h))throw h}}}function a(c){return c&&function(f,p,m){typeof p=="function"&&(m=p,p=null);function h(g,_){_&&(_.uid<0&&(_.uid+=4294967296),_.gid<0&&(_.gid+=4294967296)),m&&m.apply(this,arguments)}return p?c.call(t,f,p,h):c.call(t,f,h)}}function l(c){return c&&function(f,p){var m=p?c.call(t,f,p):c.call(t,f);return m&&(m.uid<0&&(m.uid+=4294967296),m.gid<0&&(m.gid+=4294967296)),m}}function u(c){if(!c||c.code==="ENOSYS")return!0;var f=!process.getuid||process.getuid()!==0;return!!(f&&(c.code==="EINVAL"||c.code==="EPERM"))}}});var no=w((ky,ro)=>{var to=v("stream").Stream;ro.exports=Ru;function Ru(t){return{ReadStream:e,WriteStream:r};function e(n,i){if(!(this instanceof e))return new e(n,i);to.call(this);var o=this;this.path=n,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,i=i||{};for(var s=Object.keys(i),a=0,l=s.length;a<l;a++){var u=s[a];this[u]=i[u]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){o._read()});return}t.open(this.path,this.flags,this.mode,function(c,f){if(c){o.emit("error",c),o.readable=!1;return}o.fd=f,o.emit("open",f),o._read()})}function r(n,i){if(!(this instanceof r))return new r(n,i);to.call(this),this.path=n,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,i=i||{};for(var o=Object.keys(i),s=0,a=o.length;s<a;s++){var l=o[s];this[l]=i[l]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=t.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}});var oo=w((Cy,io)=>{"use strict";io.exports=Bu;var $u=Object.getPrototypeOf||function(t){return t.__proto__};function Bu(t){if(t===null||typeof t!="object")return t;if(t instanceof Object)var e={__proto__:$u(t)};else var e=Object.create(null);return Object.getOwnPropertyNames(t).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}});var te=w((Oy,yn)=>{var D=v("fs"),ju=eo(),Uu=no(),qu=oo(),ur=v("util"),G,pr;typeof Symbol=="function"&&typeof Symbol.for=="function"?(G=Symbol.for("graceful-fs.queue"),pr=Symbol.for("graceful-fs.previous")):(G="___graceful-fs.queue",pr="___graceful-fs.previous");function Wu(){}function co(t,e){Object.defineProperty(t,G,{get:function(){return e}})}var Qe=Wu;ur.debuglog?Qe=ur.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(Qe=function(){var t=ur.format.apply(ur,arguments);t="GFS4: "+t.split(/\n/).join(`
GFS4: `),console.error(t)});D[G]||(so=global[G]||[],co(D,so),D.close=function(t){function e(r,n){return t.call(D,r,function(i){i||ao(),typeof n=="function"&&n.apply(this,arguments)})}return Object.defineProperty(e,pr,{value:t}),e}(D.close),D.closeSync=function(t){function e(r){t.apply(D,arguments),ao()}return Object.defineProperty(e,pr,{value:t}),e}(D.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){Qe(D[G]),v("assert").equal(D[G].length,0)}));var so;global[G]||co(global,D[G]);yn.exports=hn(qu(D));process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!D.__patched&&(yn.exports=hn(D),D.__patched=!0);function hn(t){ju(t),t.gracefulify=hn,t.createReadStream=Ie,t.createWriteStream=be;var e=t.readFile;t.readFile=r;function r(x,k,E){return typeof k=="function"&&(E=k,k=null),B(x,k,E);function B(j,P,L,N){return e(j,P,function(T){T&&(T.code==="EMFILE"||T.code==="ENFILE")?lt([B,[j,P,L],T,N||Date.now(),Date.now()]):typeof L=="function"&&L.apply(this,arguments)})}}var n=t.writeFile;t.writeFile=i;function i(x,k,E,B){return typeof E=="function"&&(B=E,E=null),j(x,k,E,B);function j(P,L,N,T,V){return n(P,L,N,function(I){I&&(I.code==="EMFILE"||I.code==="ENFILE")?lt([j,[P,L,N,T],I,V||Date.now(),Date.now()]):typeof T=="function"&&T.apply(this,arguments)})}}var o=t.appendFile;o&&(t.appendFile=s);function s(x,k,E,B){return typeof E=="function"&&(B=E,E=null),j(x,k,E,B);function j(P,L,N,T,V){return o(P,L,N,function(I){I&&(I.code==="EMFILE"||I.code==="ENFILE")?lt([j,[P,L,N,T],I,V||Date.now(),Date.now()]):typeof T=="function"&&T.apply(this,arguments)})}}var a=t.copyFile;a&&(t.copyFile=l);function l(x,k,E,B){return typeof E=="function"&&(B=E,E=0),j(x,k,E,B);function j(P,L,N,T,V){return a(P,L,N,function(I){I&&(I.code==="EMFILE"||I.code==="ENFILE")?lt([j,[P,L,N,T],I,V||Date.now(),Date.now()]):typeof T=="function"&&T.apply(this,arguments)})}}var u=t.readdir;t.readdir=f;var c=/^v[0-5]\./;function f(x,k,E){typeof k=="function"&&(E=k,k=null);var B=c.test(process.version)?function(L,N,T,V){return u(L,j(L,N,T,V))}:function(L,N,T,V){return u(L,N,j(L,N,T,V))};return B(x,k,E);function j(P,L,N,T){return function(V,I){V&&(V.code==="EMFILE"||V.code==="ENFILE")?lt([B,[P,L,N],V,T||Date.now(),Date.now()]):(I&&I.sort&&I.sort(),typeof N=="function"&&N.call(this,V,I))}}}if(process.version.substr(0,4)==="v0.8"){var p=Uu(t);S=p.ReadStream,O=p.WriteStream}var m=t.ReadStream;m&&(S.prototype=Object.create(m.prototype),S.prototype.open=C);var h=t.WriteStream;h&&(O.prototype=Object.create(h.prototype),O.prototype.open=W),Object.defineProperty(t,"ReadStream",{get:function(){return S},set:function(x){S=x},enumerable:!0,configurable:!0}),Object.defineProperty(t,"WriteStream",{get:function(){return O},set:function(x){O=x},enumerable:!0,configurable:!0});var g=S;Object.defineProperty(t,"FileReadStream",{get:function(){return g},set:function(x){g=x},enumerable:!0,configurable:!0});var _=O;Object.defineProperty(t,"FileWriteStream",{get:function(){return _},set:function(x){_=x},enumerable:!0,configurable:!0});function S(x,k){return this instanceof S?(m.apply(this,arguments),this):S.apply(Object.create(S.prototype),arguments)}function C(){var x=this;we(x.path,x.flags,x.mode,function(k,E){k?(x.autoClose&&x.destroy(),x.emit("error",k)):(x.fd=E,x.emit("open",E),x.read())})}function O(x,k){return this instanceof O?(h.apply(this,arguments),this):O.apply(Object.create(O.prototype),arguments)}function W(){var x=this;we(x.path,x.flags,x.mode,function(k,E){k?(x.destroy(),x.emit("error",k)):(x.fd=E,x.emit("open",E))})}function Ie(x,k){return new t.ReadStream(x,k)}function be(x,k){return new t.WriteStream(x,k)}var Ye=t.open;t.open=we;function we(x,k,E,B){return typeof E=="function"&&(B=E,E=null),j(x,k,E,B);function j(P,L,N,T,V){return Ye(P,L,N,function(I,Wg){I&&(I.code==="EMFILE"||I.code==="ENFILE")?lt([j,[P,L,N,T],I,V||Date.now(),Date.now()]):typeof T=="function"&&T.apply(this,arguments)})}}return t}function lt(t){Qe("ENQUEUE",t[0].name,t[1]),D[G].push(t),gn()}var fr;function ao(){for(var t=Date.now(),e=0;e<D[G].length;++e)D[G][e].length>2&&(D[G][e][3]=t,D[G][e][4]=t);gn()}function gn(){if(clearTimeout(fr),fr=void 0,D[G].length!==0){var t=D[G].shift(),e=t[0],r=t[1],n=t[2],i=t[3],o=t[4];if(i===void 0)Qe("RETRY",e.name,r),e.apply(null,r);else if(Date.now()-i>=6e4){Qe("TIMEOUT",e.name,r);var s=r.pop();typeof s=="function"&&s.call(null,n)}else{var a=Date.now()-o,l=Math.max(o-i,1),u=Math.min(l*1.2,100);a>=u?(Qe("RETRY",e.name,r),e.apply(null,r.concat([i]))):D[G].push(t)}fr===void 0&&(fr=setTimeout(gn,0))}}});var Ze=w(ke=>{"use strict";var lo=ee().fromCallback,K=te(),Vu=["access","appendFile","chmod","chown","close","copyFile","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchmod","lchown","link","lstat","mkdir","mkdtemp","open","opendir","readdir","readFile","readlink","realpath","rename","rm","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"].filter(t=>typeof K[t]=="function");Object.assign(ke,K);Vu.forEach(t=>{ke[t]=lo(K[t])});ke.exists=function(t,e){return typeof e=="function"?K.exists(t,e):new Promise(r=>K.exists(t,r))};ke.read=function(t,e,r,n,i,o){return typeof o=="function"?K.read(t,e,r,n,i,o):new Promise((s,a)=>{K.read(t,e,r,n,i,(l,u,c)=>{if(l)return a(l);s({bytesRead:u,buffer:c})})})};ke.write=function(t,e,...r){return typeof r[r.length-1]=="function"?K.write(t,e,...r):new Promise((n,i)=>{K.write(t,e,...r,(o,s,a)=>{if(o)return i(o);n({bytesWritten:s,buffer:a})})})};ke.readv=function(t,e,...r){return typeof r[r.length-1]=="function"?K.readv(t,e,...r):new Promise((n,i)=>{K.readv(t,e,...r,(o,s,a)=>{if(o)return i(o);n({bytesRead:s,buffers:a})})})};ke.writev=function(t,e,...r){return typeof r[r.length-1]=="function"?K.writev(t,e,...r):new Promise((n,i)=>{K.writev(t,e,...r,(o,s,a)=>{if(o)return i(o);n({bytesWritten:s,buffers:a})})})};typeof K.realpath.native=="function"?ke.realpath.native=lo(K.realpath.native):process.emitWarning("fs.realpath.native is not a function. Is fs being monkey-patched?","Warning","fs-extra-WARN0003")});var fo=w((Ny,uo)=>{"use strict";var Hu=v("path");uo.exports.checkPath=function(e){if(process.platform==="win32"&&/[<>:"|?*]/.test(e.replace(Hu.parse(e).root,""))){let n=new Error(`Path contains invalid characters: ${e}`);throw n.code="EINVAL",n}}});var go=w((Ty,_n)=>{"use strict";var po=Ze(),{checkPath:mo}=fo(),ho=t=>{let e={mode:511};return typeof t=="number"?t:{...e,...t}.mode};_n.exports.makeDir=async(t,e)=>(mo(t),po.mkdir(t,{mode:ho(e),recursive:!0}));_n.exports.makeDirSync=(t,e)=>(mo(t),po.mkdirSync(t,{mode:ho(e),recursive:!0}))});var me=w((My,yo)=>{"use strict";var Gu=ee().fromPromise,{makeDir:Ju,makeDirSync:wn}=go(),vn=Gu(Ju);yo.exports={mkdirs:vn,mkdirsSync:wn,mkdirp:vn,mkdirpSync:wn,ensureDir:vn,ensureDirSync:wn}});var Re=w((Iy,wo)=>{"use strict";var zu=ee().fromPromise,_o=Ze();function Yu(t){return _o.access(t).then(()=>!0).catch(()=>!1)}wo.exports={pathExists:zu(Yu),pathExistsSync:_o.existsSync}});var xn=w((Dy,vo)=>{"use strict";var ut=te();function Ku(t,e,r,n){ut.open(t,"r+",(i,o)=>{if(i)return n(i);ut.futimes(o,e,r,s=>{ut.close(o,a=>{n&&n(s||a)})})})}function Xu(t,e,r){let n=ut.openSync(t,"r+");return ut.futimesSync(n,e,r),ut.closeSync(n)}vo.exports={utimesMillis:Ku,utimesMillisSync:Xu}});var et=w((Fy,Eo)=>{"use strict";var ft=Ze(),U=v("path"),Qu=v("util");function Zu(t,e,r){let n=r.dereference?i=>ft.stat(i,{bigint:!0}):i=>ft.lstat(i,{bigint:!0});return Promise.all([n(t),n(e).catch(i=>{if(i.code==="ENOENT")return null;throw i})]).then(([i,o])=>({srcStat:i,destStat:o}))}function ef(t,e,r){let n,i=r.dereference?s=>ft.statSync(s,{bigint:!0}):s=>ft.lstatSync(s,{bigint:!0}),o=i(t);try{n=i(e)}catch(s){if(s.code==="ENOENT")return{srcStat:o,destStat:null};throw s}return{srcStat:o,destStat:n}}function tf(t,e,r,n,i){Qu.callbackify(Zu)(t,e,n,(o,s)=>{if(o)return i(o);let{srcStat:a,destStat:l}=s;if(l){if(Ct(a,l)){let u=U.basename(t),c=U.basename(e);return r==="move"&&u!==c&&u.toLowerCase()===c.toLowerCase()?i(null,{srcStat:a,destStat:l,isChangingCase:!0}):i(new Error("Source and destination must not be the same."))}if(a.isDirectory()&&!l.isDirectory())return i(new Error(`Cannot overwrite non-directory '${e}' with directory '${t}'.`));if(!a.isDirectory()&&l.isDirectory())return i(new Error(`Cannot overwrite directory '${e}' with non-directory '${t}'.`))}return a.isDirectory()&&Sn(t,e)?i(new Error(mr(t,e,r))):i(null,{srcStat:a,destStat:l})})}function rf(t,e,r,n){let{srcStat:i,destStat:o}=ef(t,e,n);if(o){if(Ct(i,o)){let s=U.basename(t),a=U.basename(e);if(r==="move"&&s!==a&&s.toLowerCase()===a.toLowerCase())return{srcStat:i,destStat:o,isChangingCase:!0};throw new Error("Source and destination must not be the same.")}if(i.isDirectory()&&!o.isDirectory())throw new Error(`Cannot overwrite non-directory '${e}' with directory '${t}'.`);if(!i.isDirectory()&&o.isDirectory())throw new Error(`Cannot overwrite directory '${e}' with non-directory '${t}'.`)}if(i.isDirectory()&&Sn(t,e))throw new Error(mr(t,e,r));return{srcStat:i,destStat:o}}function xo(t,e,r,n,i){let o=U.resolve(U.dirname(t)),s=U.resolve(U.dirname(r));if(s===o||s===U.parse(s).root)return i();ft.stat(s,{bigint:!0},(a,l)=>a?a.code==="ENOENT"?i():i(a):Ct(e,l)?i(new Error(mr(t,r,n))):xo(t,e,s,n,i))}function So(t,e,r,n){let i=U.resolve(U.dirname(t)),o=U.resolve(U.dirname(r));if(o===i||o===U.parse(o).root)return;let s;try{s=ft.statSync(o,{bigint:!0})}catch(a){if(a.code==="ENOENT")return;throw a}if(Ct(e,s))throw new Error(mr(t,r,n));return So(t,e,o,n)}function Ct(t,e){return e.ino&&e.dev&&e.ino===t.ino&&e.dev===t.dev}function Sn(t,e){let r=U.resolve(t).split(U.sep).filter(i=>i),n=U.resolve(e).split(U.sep).filter(i=>i);return r.reduce((i,o,s)=>i&&n[s]===o,!0)}function mr(t,e,r){return`Cannot ${r} '${t}' to a subdirectory of itself, '${e}'.`}Eo.exports={checkPaths:tf,checkPathsSync:rf,checkParentPaths:xo,checkParentPathsSync:So,isSrcSubdir:Sn,areIdentical:Ct}});var Lo=w((Ay,Oo)=>{"use strict";var re=te(),Ot=v("path"),nf=me().mkdirs,of=Re().pathExists,sf=xn().utimesMillis,Lt=et();function af(t,e,r,n){typeof r=="function"&&!n?(n=r,r={}):typeof r=="function"&&(r={filter:r}),n=n||function(){},r=r||{},r.clobber="clobber"in r?!!r.clobber:!0,r.overwrite="overwrite"in r?!!r.overwrite:r.clobber,r.preserveTimestamps&&process.arch==="ia32"&&process.emitWarning(`Using the preserveTimestamps option in 32-bit node is not recommended;

	see https://github.com/jprichardson/node-fs-extra/issues/269`,"Warning","fs-extra-WARN0001"),Lt.checkPaths(t,e,"copy",r,(i,o)=>{if(i)return n(i);let{srcStat:s,destStat:a}=o;Lt.checkParentPaths(t,s,e,"copy",l=>{if(l)return n(l);bo(t,e,r,(u,c)=>{if(u)return n(u);if(!c)return n();cf(a,t,e,r,n)})})})}function cf(t,e,r,n,i){let o=Ot.dirname(r);of(o,(s,a)=>{if(s)return i(s);if(a)return En(t,e,r,n,i);nf(o,l=>l?i(l):En(t,e,r,n,i))})}function bo(t,e,r,n){if(!r.filter)return n(null,!0);Promise.resolve(r.filter(t,e)).then(i=>n(null,i),i=>n(i))}function En(t,e,r,n,i){(n.dereference?re.stat:re.lstat)(e,(s,a)=>s?i(s):a.isDirectory()?hf(a,t,e,r,n,i):a.isFile()||a.isCharacterDevice()||a.isBlockDevice()?lf(a,t,e,r,n,i):a.isSymbolicLink()?_f(t,e,r,n,i):a.isSocket()?i(new Error(`Cannot copy a socket file: ${e}`)):a.isFIFO()?i(new Error(`Cannot copy a FIFO pipe: ${e}`)):i(new Error(`Unknown file: ${e}`)))}function lf(t,e,r,n,i,o){return e?uf(t,r,n,i,o):ko(t,r,n,i,o)}function uf(t,e,r,n,i){if(n.overwrite)re.unlink(r,o=>o?i(o):ko(t,e,r,n,i));else return n.errorOnExist?i(new Error(`'${r}' already exists`)):i()}function ko(t,e,r,n,i){re.copyFile(e,r,o=>o?i(o):n.preserveTimestamps?ff(t.mode,e,r,i):dr(r,t.mode,i))}function ff(t,e,r,n){return pf(t)?mf(r,t,i=>i?n(i):Po(t,e,r,n)):Po(t,e,r,n)}function pf(t){return(t&128)===0}function mf(t,e,r){return dr(t,e|128,r)}function Po(t,e,r,n){df(e,r,i=>i?n(i):dr(r,t,n))}function dr(t,e,r){return re.chmod(t,e,r)}function df(t,e,r){re.stat(t,(n,i)=>n?r(n):sf(e,i.atime,i.mtime,r))}function hf(t,e,r,n,i,o){return e?Co(r,n,i,o):gf(t.mode,r,n,i,o)}function gf(t,e,r,n,i){re.mkdir(r,o=>{if(o)return i(o);Co(e,r,n,s=>s?i(s):dr(r,t,i))})}function Co(t,e,r,n){re.readdir(t,(i,o)=>i?n(i):Pn(o,t,e,r,n))}function Pn(t,e,r,n,i){let o=t.pop();return o?yf(t,o,e,r,n,i):i()}function yf(t,e,r,n,i,o){let s=Ot.join(r,e),a=Ot.join(n,e);bo(s,a,i,(l,u)=>{if(l)return o(l);if(!u)return Pn(t,r,n,i,o);Lt.checkPaths(s,a,"copy",i,(c,f)=>{if(c)return o(c);let{destStat:p}=f;En(p,s,a,i,m=>m?o(m):Pn(t,r,n,i,o))})})}function _f(t,e,r,n,i){re.readlink(e,(o,s)=>{if(o)return i(o);if(n.dereference&&(s=Ot.resolve(process.cwd(),s)),t)re.readlink(r,(a,l)=>a?a.code==="EINVAL"||a.code==="UNKNOWN"?re.symlink(s,r,i):i(a):(n.dereference&&(l=Ot.resolve(process.cwd(),l)),Lt.isSrcSubdir(s,l)?i(new Error(`Cannot copy '${s}' to a subdirectory of itself, '${l}'.`)):Lt.isSrcSubdir(l,s)?i(new Error(`Cannot overwrite '${l}' with '${s}'.`)):wf(s,r,i)));else return re.symlink(s,r,i)})}function wf(t,e,r){re.unlink(e,n=>n?r(n):re.symlink(t,e,r))}Oo.exports=af});var Do=w((Ry,Io)=>{"use strict";var X=te(),Nt=v("path"),vf=me().mkdirsSync,xf=xn().utimesMillisSync,Tt=et();function Sf(t,e,r){typeof r=="function"&&(r={filter:r}),r=r||{},r.clobber="clobber"in r?!!r.clobber:!0,r.overwrite="overwrite"in r?!!r.overwrite:r.clobber,r.preserveTimestamps&&process.arch==="ia32"&&process.emitWarning(`Using the preserveTimestamps option in 32-bit node is not recommended;

	see https://github.com/jprichardson/node-fs-extra/issues/269`,"Warning","fs-extra-WARN0002");let{srcStat:n,destStat:i}=Tt.checkPathsSync(t,e,"copy",r);if(Tt.checkParentPathsSync(t,n,e,"copy"),r.filter&&!r.filter(t,e))return;let o=Nt.dirname(e);return X.existsSync(o)||vf(o),No(i,t,e,r)}function No(t,e,r,n){let o=(n.dereference?X.statSync:X.lstatSync)(e);if(o.isDirectory())return Lf(o,t,e,r,n);if(o.isFile()||o.isCharacterDevice()||o.isBlockDevice())return Ef(o,t,e,r,n);if(o.isSymbolicLink())return Mf(t,e,r,n);throw o.isSocket()?new Error(`Cannot copy a socket file: ${e}`):o.isFIFO()?new Error(`Cannot copy a FIFO pipe: ${e}`):new Error(`Unknown file: ${e}`)}function Ef(t,e,r,n,i){return e?Pf(t,r,n,i):To(t,r,n,i)}function Pf(t,e,r,n){if(n.overwrite)return X.unlinkSync(r),To(t,e,r,n);if(n.errorOnExist)throw new Error(`'${r}' already exists`)}function To(t,e,r,n){return X.copyFileSync(e,r),n.preserveTimestamps&&bf(t.mode,e,r),bn(r,t.mode)}function bf(t,e,r){return kf(t)&&Cf(r,t),Of(e,r)}function kf(t){return(t&128)===0}function Cf(t,e){return bn(t,e|128)}function bn(t,e){return X.chmodSync(t,e)}function Of(t,e){let r=X.statSync(t);return xf(e,r.atime,r.mtime)}function Lf(t,e,r,n,i){return e?Mo(r,n,i):Nf(t.mode,r,n,i)}function Nf(t,e,r,n){return X.mkdirSync(r),Mo(e,r,n),bn(r,t)}function Mo(t,e,r){X.readdirSync(t).forEach(n=>Tf(n,t,e,r))}function Tf(t,e,r,n){let i=Nt.join(e,t),o=Nt.join(r,t);if(n.filter&&!n.filter(i,o))return;let{destStat:s}=Tt.checkPathsSync(i,o,"copy",n);return No(s,i,o,n)}function Mf(t,e,r,n){let i=X.readlinkSync(e);if(n.dereference&&(i=Nt.resolve(process.cwd(),i)),t){let o;try{o=X.readlinkSync(r)}catch(s){if(s.code==="EINVAL"||s.code==="UNKNOWN")return X.symlinkSync(i,r);throw s}if(n.dereference&&(o=Nt.resolve(process.cwd(),o)),Tt.isSrcSubdir(i,o))throw new Error(`Cannot copy '${i}' to a subdirectory of itself, '${o}'.`);if(Tt.isSrcSubdir(o,i))throw new Error(`Cannot overwrite '${o}' with '${i}'.`);return If(i,r)}else return X.symlinkSync(i,r)}function If(t,e){return X.unlinkSync(e),X.symlinkSync(t,e)}Io.exports=Sf});var hr=w(($y,Fo)=>{"use strict";var Df=ee().fromCallback;Fo.exports={copy:Df(Lo()),copySync:Do()}});var Mt=w((By,Ro)=>{"use strict";var Ao=te(),Ff=ee().fromCallback;function Af(t,e){Ao.rm(t,{recursive:!0,force:!0},e)}function Rf(t){Ao.rmSync(t,{recursive:!0,force:!0})}Ro.exports={remove:Ff(Af),removeSync:Rf}});var Ho=w((jy,Vo)=>{"use strict";var $f=ee().fromPromise,jo=Ze(),Uo=v("path"),qo=me(),Wo=Mt(),$o=$f(async function(e){let r;try{r=await jo.readdir(e)}catch{return qo.mkdirs(e)}return Promise.all(r.map(n=>Wo.remove(Uo.join(e,n))))});function Bo(t){let e;try{e=jo.readdirSync(t)}catch{return qo.mkdirsSync(t)}e.forEach(r=>{r=Uo.join(t,r),Wo.removeSync(r)})}Vo.exports={emptyDirSync:Bo,emptydirSync:Bo,emptyDir:$o,emptydir:$o}});var Yo=w((Uy,zo)=>{"use strict";var Bf=ee().fromCallback,Go=v("path"),$e=te(),Jo=me();function jf(t,e){function r(){$e.writeFile(t,"",n=>{if(n)return e(n);e()})}$e.stat(t,(n,i)=>{if(!n&&i.isFile())return e();let o=Go.dirname(t);$e.stat(o,(s,a)=>{if(s)return s.code==="ENOENT"?Jo.mkdirs(o,l=>{if(l)return e(l);r()}):e(s);a.isDirectory()?r():$e.readdir(o,l=>{if(l)return e(l)})})})}function Uf(t){let e;try{e=$e.statSync(t)}catch{}if(e&&e.isFile())return;let r=Go.dirname(t);try{$e.statSync(r).isDirectory()||$e.readdirSync(r)}catch(n){if(n&&n.code==="ENOENT")Jo.mkdirsSync(r);else throw n}$e.writeFileSync(t,"")}zo.exports={createFile:Bf(jf),createFileSync:Uf}});var es=w((qy,Zo)=>{"use strict";var qf=ee().fromCallback,Ko=v("path"),Be=te(),Xo=me(),Wf=Re().pathExists,{areIdentical:Qo}=et();function Vf(t,e,r){function n(i,o){Be.link(i,o,s=>{if(s)return r(s);r(null)})}Be.lstat(e,(i,o)=>{Be.lstat(t,(s,a)=>{if(s)return s.message=s.message.replace("lstat","ensureLink"),r(s);if(o&&Qo(a,o))return r(null);let l=Ko.dirname(e);Wf(l,(u,c)=>{if(u)return r(u);if(c)return n(t,e);Xo.mkdirs(l,f=>{if(f)return r(f);n(t,e)})})})})}function Hf(t,e){let r;try{r=Be.lstatSync(e)}catch{}try{let o=Be.lstatSync(t);if(r&&Qo(o,r))return}catch(o){throw o.message=o.message.replace("lstat","ensureLink"),o}let n=Ko.dirname(e);return Be.existsSync(n)||Xo.mkdirsSync(n),Be.linkSync(t,e)}Zo.exports={createLink:qf(Vf),createLinkSync:Hf}});var rs=w((Wy,ts)=>{"use strict";var je=v("path"),It=te(),Gf=Re().pathExists;function Jf(t,e,r){if(je.isAbsolute(t))return It.lstat(t,n=>n?(n.message=n.message.replace("lstat","ensureSymlink"),r(n)):r(null,{toCwd:t,toDst:t}));{let n=je.dirname(e),i=je.join(n,t);return Gf(i,(o,s)=>o?r(o):s?r(null,{toCwd:i,toDst:t}):It.lstat(t,a=>a?(a.message=a.message.replace("lstat","ensureSymlink"),r(a)):r(null,{toCwd:t,toDst:je.relative(n,t)})))}}function zf(t,e){let r;if(je.isAbsolute(t)){if(r=It.existsSync(t),!r)throw new Error("absolute srcpath does not exist");return{toCwd:t,toDst:t}}else{let n=je.dirname(e),i=je.join(n,t);if(r=It.existsSync(i),r)return{toCwd:i,toDst:t};if(r=It.existsSync(t),!r)throw new Error("relative srcpath does not exist");return{toCwd:t,toDst:je.relative(n,t)}}}ts.exports={symlinkPaths:Jf,symlinkPathsSync:zf}});var os=w((Vy,is)=>{"use strict";var ns=te();function Yf(t,e,r){if(r=typeof e=="function"?e:r,e=typeof e=="function"?!1:e,e)return r(null,e);ns.lstat(t,(n,i)=>{if(n)return r(null,"file");e=i&&i.isDirectory()?"dir":"file",r(null,e)})}function Kf(t,e){let r;if(e)return e;try{r=ns.lstatSync(t)}catch{return"file"}return r&&r.isDirectory()?"dir":"file"}is.exports={symlinkType:Yf,symlinkTypeSync:Kf}});var ms=w((Hy,ps)=>{"use strict";var Xf=ee().fromCallback,as=v("path"),de=Ze(),cs=me(),Qf=cs.mkdirs,Zf=cs.mkdirsSync,ls=rs(),ep=ls.symlinkPaths,tp=ls.symlinkPathsSync,us=os(),rp=us.symlinkType,np=us.symlinkTypeSync,ip=Re().pathExists,{areIdentical:fs}=et();function op(t,e,r,n){n=typeof r=="function"?r:n,r=typeof r=="function"?!1:r,de.lstat(e,(i,o)=>{!i&&o.isSymbolicLink()?Promise.all([de.stat(t),de.stat(e)]).then(([s,a])=>{if(fs(s,a))return n(null);ss(t,e,r,n)}):ss(t,e,r,n)})}function ss(t,e,r,n){ep(t,e,(i,o)=>{if(i)return n(i);t=o.toDst,rp(o.toCwd,r,(s,a)=>{if(s)return n(s);let l=as.dirname(e);ip(l,(u,c)=>{if(u)return n(u);if(c)return de.symlink(t,e,a,n);Qf(l,f=>{if(f)return n(f);de.symlink(t,e,a,n)})})})})}function sp(t,e,r){let n;try{n=de.lstatSync(e)}catch{}if(n&&n.isSymbolicLink()){let a=de.statSync(t),l=de.statSync(e);if(fs(a,l))return}let i=tp(t,e);t=i.toDst,r=np(i.toCwd,r);let o=as.dirname(e);return de.existsSync(o)||Zf(o),de.symlinkSync(t,e,r)}ps.exports={createSymlink:Xf(op),createSymlinkSync:sp}});var xs=w((Gy,vs)=>{"use strict";var{createFile:ds,createFileSync:hs}=Yo(),{createLink:gs,createLinkSync:ys}=es(),{createSymlink:_s,createSymlinkSync:ws}=ms();vs.exports={createFile:ds,createFileSync:hs,ensureFile:ds,ensureFileSync:hs,createLink:gs,createLinkSync:ys,ensureLink:gs,ensureLinkSync:ys,createSymlink:_s,createSymlinkSync:ws,ensureSymlink:_s,ensureSymlinkSync:ws}});var gr=w((Jy,Ss)=>{function ap(t,{EOL:e=`
`,finalEOL:r=!0,replacer:n=null,spaces:i}={}){let o=r?e:"";return JSON.stringify(t,n,i).replace(/\n/g,e)+o}function cp(t){return Buffer.isBuffer(t)&&(t=t.toString("utf8")),t.replace(/^\uFEFF/,"")}Ss.exports={stringify:ap,stripBom:cp}});var ks=w((zy,bs)=>{var pt;try{pt=te()}catch{pt=v("fs")}var yr=ee(),{stringify:Es,stripBom:Ps}=gr();async function lp(t,e={}){typeof e=="string"&&(e={encoding:e});let r=e.fs||pt,n="throws"in e?e.throws:!0,i=await yr.fromCallback(r.readFile)(t,e);i=Ps(i);let o;try{o=JSON.parse(i,e?e.reviver:null)}catch(s){if(n)throw s.message=`${t}: ${s.message}`,s;return null}return o}var up=yr.fromPromise(lp);function fp(t,e={}){typeof e=="string"&&(e={encoding:e});let r=e.fs||pt,n="throws"in e?e.throws:!0;try{let i=r.readFileSync(t,e);return i=Ps(i),JSON.parse(i,e.reviver)}catch(i){if(n)throw i.message=`${t}: ${i.message}`,i;return null}}async function pp(t,e,r={}){let n=r.fs||pt,i=Es(e,r);await yr.fromCallback(n.writeFile)(t,i,r)}var mp=yr.fromPromise(pp);function dp(t,e,r={}){let n=r.fs||pt,i=Es(e,r);return n.writeFileSync(t,i,r)}var hp={readFile:up,readFileSync:fp,writeFile:mp,writeFileSync:dp};bs.exports=hp});var Os=w((Yy,Cs)=>{"use strict";var _r=ks();Cs.exports={readJson:_r.readFile,readJsonSync:_r.readFileSync,writeJson:_r.writeFile,writeJsonSync:_r.writeFileSync}});var wr=w((Ky,Ts)=>{"use strict";var gp=ee().fromCallback,Dt=te(),Ls=v("path"),Ns=me(),yp=Re().pathExists;function _p(t,e,r,n){typeof r=="function"&&(n=r,r="utf8");let i=Ls.dirname(t);yp(i,(o,s)=>{if(o)return n(o);if(s)return Dt.writeFile(t,e,r,n);Ns.mkdirs(i,a=>{if(a)return n(a);Dt.writeFile(t,e,r,n)})})}function wp(t,...e){let r=Ls.dirname(t);if(Dt.existsSync(r))return Dt.writeFileSync(t,...e);Ns.mkdirsSync(r),Dt.writeFileSync(t,...e)}Ts.exports={outputFile:gp(_p),outputFileSync:wp}});var Is=w((Xy,Ms)=>{"use strict";var{stringify:vp}=gr(),{outputFile:xp}=wr();async function Sp(t,e,r={}){let n=vp(e,r);await xp(t,n,r)}Ms.exports=Sp});var Fs=w((Qy,Ds)=>{"use strict";var{stringify:Ep}=gr(),{outputFileSync:Pp}=wr();function bp(t,e,r){let n=Ep(e,r);Pp(t,n,r)}Ds.exports=bp});var Rs=w((Zy,As)=>{"use strict";var kp=ee().fromPromise,Q=Os();Q.outputJson=kp(Is());Q.outputJsonSync=Fs();Q.outputJSON=Q.outputJson;Q.outputJSONSync=Q.outputJsonSync;Q.writeJSON=Q.writeJson;Q.writeJSONSync=Q.writeJsonSync;Q.readJSON=Q.readJson;Q.readJSONSync=Q.readJsonSync;As.exports=Q});var qs=w((e_,Us)=>{"use strict";var Cp=te(),Cn=v("path"),Op=hr().copy,js=Mt().remove,Lp=me().mkdirp,Np=Re().pathExists,$s=et();function Tp(t,e,r,n){typeof r=="function"&&(n=r,r={}),r=r||{};let i=r.overwrite||r.clobber||!1;$s.checkPaths(t,e,"move",r,(o,s)=>{if(o)return n(o);let{srcStat:a,isChangingCase:l=!1}=s;$s.checkParentPaths(t,a,e,"move",u=>{if(u)return n(u);if(Mp(e))return Bs(t,e,i,l,n);Lp(Cn.dirname(e),c=>c?n(c):Bs(t,e,i,l,n))})})}function Mp(t){let e=Cn.dirname(t);return Cn.parse(e).root===e}function Bs(t,e,r,n,i){if(n)return kn(t,e,r,i);if(r)return js(e,o=>o?i(o):kn(t,e,r,i));Np(e,(o,s)=>o?i(o):s?i(new Error("dest already exists.")):kn(t,e,r,i))}function kn(t,e,r,n){Cp.rename(t,e,i=>i?i.code!=="EXDEV"?n(i):Ip(t,e,r,n):n())}function Ip(t,e,r,n){Op(t,e,{overwrite:r,errorOnExist:!0,preserveTimestamps:!0},o=>o?n(o):js(t,n))}Us.exports=Tp});var Js=w((t_,Gs)=>{"use strict";var Vs=te(),Ln=v("path"),Dp=hr().copySync,Hs=Mt().removeSync,Fp=me().mkdirpSync,Ws=et();function Ap(t,e,r){r=r||{};let n=r.overwrite||r.clobber||!1,{srcStat:i,isChangingCase:o=!1}=Ws.checkPathsSync(t,e,"move",r);return Ws.checkParentPathsSync(t,i,e,"move"),Rp(e)||Fp(Ln.dirname(e)),$p(t,e,n,o)}function Rp(t){let e=Ln.dirname(t);return Ln.parse(e).root===e}function $p(t,e,r,n){if(n)return On(t,e,r);if(r)return Hs(e),On(t,e,r);if(Vs.existsSync(e))throw new Error("dest already exists.");return On(t,e,r)}function On(t,e,r){try{Vs.renameSync(t,e)}catch(n){if(n.code!=="EXDEV")throw n;return Bp(t,e,r)}}function Bp(t,e,r){return Dp(t,e,{overwrite:r,errorOnExist:!0,preserveTimestamps:!0}),Hs(t)}Gs.exports=Ap});var Ys=w((r_,zs)=>{"use strict";var jp=ee().fromCallback;zs.exports={move:jp(qs()),moveSync:Js()}});var J=w((n_,Ks)=>{"use strict";Ks.exports={...Ze(),...hr(),...Ho(),...xs(),...Rs(),...me(),...Ys(),...wr(),...Re(),...Mt()}});var Xs,Qs=y(()=>{Xs=()=>`
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.js

# testing
/coverage

#cache
.turbo
.next
.vercel

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*


# local env files
.env*

out/
build/
dist/

# plasmo - https://www.plasmo.com
.plasmo

# bpp - http://bpp.browser.market/
keys.json

# typescript
.tsbuildinfo
`});import{userInfo as Up}from"os";import{sentenceCase as qp}from"change-case";import Wp from"package-json";var Vp,Zs,Nn,Tn=y(()=>{Vp=async({name:t="plasmo-extension",version:e="0.0.1",packageManager:r={}})=>{let n={name:t,displayName:qp(t),version:e,description:"A basic Plasmo extension.",author:Up().username,packageManager:void 0,scripts:{dev:"plasmo dev",build:"plasmo build",package:"plasmo package"},dependencies:{plasmo:"workspace:*",react:"*","react-dom":"*"},devDependencies:{"@types/chrome":"*","@types/node":"*","@types/react":"*","@types/react-dom":"*",prettier:"*",typescript:"*"},manifest:{host_permissions:["https://*/*"]}};return!r||!r.version?delete n.packageManager:n.packageManager=`${r.name}@${r.version}`,n},Zs=async t=>await Vp(t),Nn=async t=>{let e={};return await Promise.all(Object.entries(t).map(async([r,n])=>{if(r==="plasmo")e[r]="0.83.0";else if(n==="workspace:*")try{let i=await Wp(r,{version:"latest"});e[r]=i.version}catch{e[r]=n}else e[r]=n})),e}});import{dirname as Hp,resolve as mt}from"path";import{fileURLToPath as Gp}from"url";var vr,Mn=y(()=>{vr=()=>{let t=Hp(Gp(import.meta.url)),e=mt(t,"..","templates"),r=mt(e,"static"),n=mt(v.resolve("@plasmohq/init"),".."),i=mt(n,"templates"),o=mt(n,"entries"),s=mt(n,"bpp.yml");return{templatePath:e,initTemplatePath:i,initEntryPath:o,staticTemplatePath:r,bppYaml:s}}});import Jp from"inquirer";var dt,In=y(()=>{dt=async(t="",e="")=>{let{data:r}=await Jp.prompt({name:"data",prefix:"\u{1F7E1}",message:t,default:e});return r}});import{readFile as zp}from"fs/promises";import{extname as Yp}from"path";import{strFromU8 as Kp,unzipSync as Xp}from"fflate";async function Qp(t,e,r){if(t.content_security_policy&&(d("Convert content_security_policy"),e.manifest.content_security_policy={extension_pages:t.content_security_policy}),t.web_accessible_resources&&(d("Convert web_accessible_resources"),e.manifest.web_accessible_resources=[{matches:["https://*/*"],resources:t.web_accessible_resources}]),t.permissions){d("Convert permissions"),e.manifest.permissions=[],e.manifest.host_permissions=[];for(let n of t.permissions)n.startsWith("http")||n==="<all_urls>"?e.manifest.host_permissions.push(n):e.manifest.permissions.push(n)}t.browser_action&&(d("Convert browser_action"),e.manifest.action={default_title:t.browser_action.default_title}),t.background&&d("Convert background")}async function Zp(t,e,r){t.content_security_policy&&(d("Convert content_security_policy"),e.manifest.content_security_policy={...t.content_security_policy}),t.web_accessible_resources&&(d("Convert web_accessible_resources"),e.manifest.web_accessible_resources=[...t.web_accessible_resources]),t.permissions&&(d("Transfer permissions"),e.manifest.permissions=[...t.permissions]),t.host_permissions&&(d("Transfer host_permissions"),e.manifest.host_permissions=[...t.host_permissions]),t.action&&(d("Convert browser_action"),e.manifest.action={default_title:t.action.default_title}),t.background&&d("Convert background")}var ea,ta,ra,na=y(()=>{ea=A(J(),1);b();Tn();ta=async t=>{let e={unzipped:{},isZip:!1,manifestData:{}},r=Yp(t);if(r===".zip"){let n=await zp(t);e.unzipped=Xp(n),e.isZip=!0,e.manifestData=JSON.parse(Kp(e.unzipped["manifest.json"]))}else if(r===".json")e.manifestData=await(0,ea.readJson)(t);else return null;return e},ra=async(t,e,{manifestData:r})=>{let n=await Zs({name:t.packageName,packageManager:e});switch(n.version=r.version,n.displayName=r.name,n.description=r.description,r?.author&&(n.author=r.author),r.homepage_url&&(n.homepage=r.homepage_url),r.version_name&&(n.manifest.version_name=r.version_name),r.browser_specific_settings&&(n.manifest.browser_specific_settings=r.browser_specific_settings),r.default_locale&&d("Convert locale"),r.options_ui&&d("Convert options_ui"),r.chrome_url_overrides&&d("Convert chrome_url_overrides"),r.icons&&d("Convert icons"),r.content_scripts&&d("Convert content_scripts"),r.manifest_version){case 2:await Qp(r,n,t);break;case 3:await Zp(r,n,t);break;default:throw new Error("Unknown manifest version")}return n}});import{existsSync as ia}from"fs";import{lstat as em,readFile as tm,writeFile as rm}from"fs/promises";import{isAbsolute as nm,join as im,relative as om,resolve as Ft}from"path";import sm from"@expo/spawn-async";import{sentenceCase as am}from"change-case";import cm from"ignore";import{temporaryDirectory as lm}from"tempy";var he,um,xr,oa=y(()=>{he=A(J(),1);pe();Y();b();Qs();Tn();Mn();In();na();um=/(?:^--with-)(?:\w+-?)+(?:[^-]$)/,xr=class{constructor(e,r,n=!1){this.commonPath=e;this.packageManager=r;this.isExample=n}templatePath=vr();async create(){return await this.createFrom()||await this.createWith()||await this.createBlank()}async createFrom(){let e=H("--from");if(!e)return!1;let r=nm(e)?e:Ft(e),n=await em(r);return n.isFile()?await this.createFromManifest(r):n.isDirectory()?await this.createFromLocalTemplate(r):!1}async createFromLocalTemplate(e){let r=cm().add(["node_modules",".git",".env*"]),n=im(e,".gitignore");if(await F(n)){let s=await tm(n,"utf-8");r.add(s)}await(0,he.copy)(e,this.commonPath.projectDirectory,{filter:s=>s===e||!r.ignores(om(e,s))});let o=await(0,he.readJson)(this.commonPath.packageFilePath);return await this.outputPackageData(o),M(`Creating new project from ${e}`),!0}async createFromManifest(e){let r=await ta(e);if(r===null)return!1;await this.copyBlankInitFiles();let n=await ra(this.commonPath,this.packageManager,r);return await this.outputPackageData(n,{resolveWorkspaceRefs:!0}),!0}async createWith(){let e=process.argv.find(r=>um.test(r));return e===void 0?!1:this.createWithExample(e.substring(2))}async createWithExample(e){let r=lm();d(`Download examples to temporary directory: ${r}`);try{await sm("git",["clone","--depth","1","https://github.com/PlasmoHQ/examples.git","."],{cwd:r,ignoreStdio:!0})}catch(o){if(o.errno==="ENOENT")throw new Error("Unable to clone example repo. `git` is not in PATH.")}let n=Ft(r,e);if(!ia(n))throw new Error(`Example ${e} not found. You may file an example request at: https://docs.plasmo.com/exp`);d("Copy example to project directory"),await Promise.all([(0,he.copy)(n,this.commonPath.projectDirectory),this.copyBppWorkflow()]);let i=await(0,he.readJson)(this.commonPath.packageFilePath);return await this.outputPackageData(i,{resolveWorkspaceRefs:!0}),M(`Creating new project ${e.split("-").join(" ")}`),!0}async createBlank(){return await this.createWithExample("with-popup"),!0}async outputPackageData(e,{resolveWorkspaceRefs:r=!1}={}){let{packageName:n,packageFilePath:i}=this.commonPath;if(e.name=n,e.displayName=am(n),e.description=await dt("Extension description:",e.description),this.isExample)delete e.packageManager,e.contributors=[await dt("Contributor name:",e.author)],e.author="Plasmo Corp. <foss@plasmo.com>";else if(delete e.contributors,e.author=await dt("Author name:",e.author),r){d("Replace workspace refs with the latest package version from npm registry");let o=await Promise.all([Nn(e.dependencies),Nn(e.devDependencies)]);e.dependencies=o[0],e.devDependencies=o[1]}await(0,he.outputJson)(i,e,{spaces:2})}async copyBlankInitFiles(){let r=(H("--entry")||"popup").split(new RegExp(",|\\s")).flatMap(n=>[`${n}.ts`,`${n}.tsx`]).map(n=>[Ft(this.templatePath.initEntryPath,n),Ft(this.commonPath.projectDirectory,n)]).filter(([n])=>ia(n));d("Using the following entry files: ",r),await Promise.all([(0,he.copy)(this.templatePath.initTemplatePath,this.commonPath.projectDirectory),this.copyBppWorkflow(),rm(this.commonPath.gitIgnorePath,Xs())]),await Promise.all(r.map(([n,i])=>(0,he.copy)(n,i)))}async copyBppWorkflow(){if(this.isExample||$("--no-bpp"))return;d("Copying BPP workflow...");let e=Ft(this.commonPath.projectDirectory,".github","workflows","submit.yml");return(0,he.copy)(this.templatePath.bppYaml,e)}}});import{createQuestId as fm}from"mnemonic-id";var sa,aa=y(()=>{rr();b();In();sa=async()=>{let[t]=tr("init");return t?(d("Using user-provided name:",t),t):(d("Prompting for the extension name"),await dt("Extension name:",fm()))}});import Sr from"@expo/spawn-async";async function ca(t,e){if(!await F(t.gitIgnorePath))return!1;try{return await pm(e)}catch(r){return Z(r.message),!1}}var pm,la=y(()=>{Y();b();pm=async t=>{let{default:e}=await import("chalk"),r={cwd:t,ignoreStdio:!0};try{return d("Checking if the root is a git repository"),await Sr("git",["rev-parse","--is-inside-work-tree"],r),d(`${t} is a git repository, bailing ${e.bold("git init")}`),!1}catch(n){if(n.errno==="ENOENT")throw new Error("Unable to initialize git repo. `git` not in PATH.")}return M("Initializing git project..."),await Sr("git",["init"],r),await Sr("git",["add","--all"],r),await Sr("git",["commit","-m","Created a new Plasmo extension"],r),d("Added all files to git and created the initial commit."),!0}});import mm from"@expo/spawn-async";var ua,fa=y(()=>{b();ua=async(t,e)=>{try{M("Installing dependencies..."),await mm(e.name,["install"],{cwd:t,stdio:"inherit"})}catch(r){Z(r.message)}}});var pa,ma=y(()=>{b();pa=async(t,e,r,n)=>{let{default:i}=await import("chalk");De("Your extension is ready in: ",i.yellowBright(t),`

    To start hacking, run:

`,t===e?"":`      cd ${r.packageName}
`,`      ${n.name} ${n.name==="npm"?"run dev":"dev"}
`,`
    Visit https://docs.plasmo.com for documentation and more examples.`)}});var da={};Ke(da,{default:()=>_m});import{resolve as dm}from"path";import{cwd as hm}from"process";import{paramCase as gm}from"change-case";async function ym(){ue();let t=$("--exp"),e=await sa(),r=hm(),n=dm(r,gm(e)||e);d("Project directory:",n);let i=at(n);if(d("Package name:",i.packageName),t&&!i.packageName.startsWith("with-"))throw new Error("Example extensions must have the `with-` prefix");await Qi(n);let o=await ct();d(`Using package manager: ${o.name} ${o?.version}`),await new xr(i,o,t).create(),await ua(n,o),await ca(i,n),await pa(n,r,i,o)}var _m,ha=y(()=>{pe();Y();b();ar();cr();Xe();oa();aa();la();fa();ma();_m=ym});var wa=w((fw,_a)=>{"use strict";var{Duplex:wm}=v("stream");function ga(t){t.emit("close")}function vm(){!this.destroyed&&this._writableState.finished&&this.destroy()}function ya(t){this.removeListener("error",ya),this.destroy(),this.listenerCount("error")===0&&this.emit("error",t)}function xm(t,e){let r=!0,n=new wm({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return t.on("message",function(o,s){let a=!s&&n._readableState.objectMode?o.toString():o;n.push(a)||t.pause()}),t.once("error",function(o){n.destroyed||(r=!1,n.destroy(o))}),t.once("close",function(){n.destroyed||n.push(null)}),n._destroy=function(i,o){if(t.readyState===t.CLOSED){o(i),process.nextTick(ga,n);return}let s=!1;t.once("error",function(l){s=!0,o(l)}),t.once("close",function(){s||o(i),process.nextTick(ga,n)}),r&&t.terminate()},n._final=function(i){if(t.readyState===t.CONNECTING){t.once("open",function(){n._final(i)});return}t._socket!==null&&(t._socket._writableState.finished?(i(),n._readableState.endEmitted&&n.destroy()):(t._socket.once("finish",function(){i()}),t.close()))},n._read=function(){t.isPaused&&t.resume()},n._write=function(i,o,s){if(t.readyState===t.CONNECTING){t.once("open",function(){n._write(i,o,s)});return}t.send(i,s)},n.on("end",vm),n.on("error",ya),n}_a.exports=xm});var Ue=w((pw,va)=>{"use strict";va.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var Aa=w((mw,Fa)=>{var Pa=v("fs"),Ce=v("path"),ba=v("os"),ka=typeof __webpack_require__=="function"?__non_webpack_require__:v,Sm=process.config&&process.config.variables||{},Em=!!process.env.PREBUILDS_ONLY,xa=process.versions.modules,Dn=km()?"electron":bm()?"node-webkit":"node",Fn=process.env.npm_config_arch||ba.arch(),An=process.env.npm_config_platform||ba.platform(),Ca=process.env.LIBC||(Cm(An)?"musl":"glibc"),Rn=process.env.ARM_VERSION||(Fn==="arm64"?"8":Sm.arm_version)||"",Oa=(process.versions.uv||"").split(".")[0];Fa.exports=xe;function xe(t){return ka(xe.resolve(t))}xe.resolve=xe.path=function(t){t=Ce.resolve(t||".");try{var e=ka(Ce.join(t,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[e+"_PREBUILD"]&&(t=process.env[e+"_PREBUILD"])}catch{}if(!Em){var r=Sa(Ce.join(t,"build/Release"),Ea);if(r)return r;var n=Sa(Ce.join(t,"build/Debug"),Ea);if(n)return n}var i=a(t);if(i)return i;var o=a(Ce.dirname(process.execPath));if(o)return o;var s=["platform="+An,"arch="+Fn,"runtime="+Dn,"abi="+xa,"uv="+Oa,Rn?"armv="+Rn:"","libc="+Ca,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"",typeof __webpack_require__=="function"?"webpack=true":""].filter(Boolean).join(" ");throw new Error("No native build was found for "+s+`
    loaded from: `+t+`
`);function a(l){var u=$n(Ce.join(l,"prebuilds")).map(La),c=u.filter(Na(An,Fn)).sort(Ta)[0];if(c){var f=Ce.join(l,"prebuilds",c.name),p=$n(f).map(Ma),m=p.filter(Ia(Dn,xa)),h=m.sort(Da(Dn))[0];if(h)return Ce.join(f,h.file)}}};function $n(t){try{return Pa.readdirSync(t)}catch{return[]}}function Sa(t,e){var r=$n(t).filter(e);return r[0]&&Ce.join(t,r[0])}function Ea(t){return/\.node$/.test(t)}function La(t){var e=t.split("-");if(e.length===2){var r=e[0],n=e[1].split("+");if(r&&n.length&&n.every(Boolean))return{name:t,platform:r,architectures:n}}}function Na(t,e){return function(r){return r==null||r.platform!==t?!1:r.architectures.includes(e)}}function Ta(t,e){return t.architectures.length-e.architectures.length}function Ma(t){var e=t.split("."),r=e.pop(),n={file:t,specificity:0};if(r==="node"){for(var i=0;i<e.length;i++){var o=e[i];if(o==="node"||o==="electron"||o==="node-webkit")n.runtime=o;else if(o==="napi")n.napi=!0;else if(o.slice(0,3)==="abi")n.abi=o.slice(3);else if(o.slice(0,2)==="uv")n.uv=o.slice(2);else if(o.slice(0,4)==="armv")n.armv=o.slice(4);else if(o==="glibc"||o==="musl")n.libc=o;else continue;n.specificity++}return n}}function Ia(t,e){return function(r){return!(r==null||r.runtime!==t&&!Pm(r)||r.abi!==e&&!r.napi||r.uv&&r.uv!==Oa||r.armv&&r.armv!==Rn||r.libc&&r.libc!==Ca)}}function Pm(t){return t.runtime==="node"&&t.napi}function Da(t){return function(e,r){return e.runtime!==r.runtime?e.runtime===t?-1:1:e.abi!==r.abi?e.abi?-1:1:e.specificity!==r.specificity?e.specificity>r.specificity?-1:1:0}}function bm(){return!!(process.versions&&process.versions.nw)}function km(){return process.versions&&process.versions.electron||process.env.ELECTRON_RUN_AS_NODE?!0:typeof window<"u"&&window.process&&window.process.type==="renderer"}function Cm(t){return t==="linux"&&Pa.existsSync("/etc/alpine-release")}xe.parseTags=Ma;xe.matchTags=Ia;xe.compareTags=Da;xe.parseTuple=La;xe.matchTuple=Na;xe.compareTuples=Ta});var jn=w((hw,Bn)=>{typeof process.addon=="function"?Bn.exports=process.addon.bind(process):Bn.exports=Aa()});var $a=w((gw,Ra)=>{"use strict";var Om=(t,e,r,n,i)=>{for(var o=0;o<i;o++)r[n+o]=t[o]^e[o&3]},Lm=(t,e)=>{let r=t.length;for(var n=0;n<r;n++)t[n]^=e[n&3]};Ra.exports={mask:Om,unmask:Lm}});var Ba=w((yw,Un)=>{"use strict";try{Un.exports=jn()(__dirname)}catch{Un.exports=$a()}});var At=w((_w,Er)=>{"use strict";var{EMPTY_BUFFER:Nm}=Ue(),qn=Buffer[Symbol.species];function Tm(t,e){if(t.length===0)return Nm;if(t.length===1)return t[0];let r=Buffer.allocUnsafe(e),n=0;for(let i=0;i<t.length;i++){let o=t[i];r.set(o,n),n+=o.length}return n<e?new qn(r.buffer,r.byteOffset,n):r}function ja(t,e,r,n,i){for(let o=0;o<i;o++)r[n+o]=t[o]^e[o&3]}function Ua(t,e){for(let r=0;r<t.length;r++)t[r]^=e[r&3]}function Mm(t){return t.length===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.length)}function Wn(t){if(Wn.readOnly=!0,Buffer.isBuffer(t))return t;let e;return t instanceof ArrayBuffer?e=new qn(t):ArrayBuffer.isView(t)?e=new qn(t.buffer,t.byteOffset,t.byteLength):(e=Buffer.from(t),Wn.readOnly=!1),e}Er.exports={concat:Tm,mask:ja,toArrayBuffer:Mm,toBuffer:Wn,unmask:Ua};if(!process.env.WS_NO_BUFFER_UTIL)try{let t=Ba();Er.exports.mask=function(e,r,n,i,o){o<48?ja(e,r,n,i,o):t.mask(e,r,n,i,o)},Er.exports.unmask=function(e,r){e.length<32?Ua(e,r):t.unmask(e,r)}}catch{}});var Va=w((ww,Wa)=>{"use strict";var qa=Symbol("kDone"),Vn=Symbol("kRun"),Hn=class{constructor(e){this[qa]=()=>{this.pending--,this[Vn]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[Vn]()}[Vn](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[qa])}}};Wa.exports=Hn});var Bt=w((vw,za)=>{"use strict";var Rt=v("zlib"),Ha=At(),Im=Va(),{kStatusCode:Ga}=Ue(),Dm=Buffer[Symbol.species],Fm=Buffer.from([0,0,255,255]),kr=Symbol("permessage-deflate"),Oe=Symbol("total-length"),$t=Symbol("callback"),qe=Symbol("buffers"),br=Symbol("error"),Pr,Gn=class{constructor(e,r,n){if(this._maxPayload=n|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!r,this._deflate=null,this._inflate=null,this.params=null,!Pr){let i=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Pr=new Im(i)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[$t];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let r=this._options,n=e.find(i=>!(r.serverNoContextTakeover===!1&&i.server_no_context_takeover||i.server_max_window_bits&&(r.serverMaxWindowBits===!1||typeof r.serverMaxWindowBits=="number"&&r.serverMaxWindowBits>i.server_max_window_bits)||typeof r.clientMaxWindowBits=="number"&&!i.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return r.serverNoContextTakeover&&(n.server_no_context_takeover=!0),r.clientNoContextTakeover&&(n.client_no_context_takeover=!0),typeof r.serverMaxWindowBits=="number"&&(n.server_max_window_bits=r.serverMaxWindowBits),typeof r.clientMaxWindowBits=="number"?n.client_max_window_bits=r.clientMaxWindowBits:(n.client_max_window_bits===!0||r.clientMaxWindowBits===!1)&&delete n.client_max_window_bits,n}acceptAsClient(e){let r=e[0];if(this._options.clientNoContextTakeover===!1&&r.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!r.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(r.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&r.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return r}normalizeParams(e){return e.forEach(r=>{Object.keys(r).forEach(n=>{let i=r[n];if(i.length>1)throw new Error(`Parameter "${n}" must have only a single value`);if(i=i[0],n==="client_max_window_bits"){if(i!==!0){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${n}": ${i}`);i=o}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${n}": ${i}`)}else if(n==="server_max_window_bits"){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${n}": ${i}`);i=o}else if(n==="client_no_context_takeover"||n==="server_no_context_takeover"){if(i!==!0)throw new TypeError(`Invalid value for parameter "${n}": ${i}`)}else throw new Error(`Unknown parameter "${n}"`);r[n]=i})}),e}decompress(e,r,n){Pr.add(i=>{this._decompress(e,r,(o,s)=>{i(),n(o,s)})})}compress(e,r,n){Pr.add(i=>{this._compress(e,r,(o,s)=>{i(),n(o,s)})})}_decompress(e,r,n){let i=this._isServer?"client":"server";if(!this._inflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?Rt.Z_DEFAULT_WINDOWBITS:this.params[o];this._inflate=Rt.createInflateRaw({...this._options.zlibInflateOptions,windowBits:s}),this._inflate[kr]=this,this._inflate[Oe]=0,this._inflate[qe]=[],this._inflate.on("error",Rm),this._inflate.on("data",Ja)}this._inflate[$t]=n,this._inflate.write(e),r&&this._inflate.write(Fm),this._inflate.flush(()=>{let o=this._inflate[br];if(o){this._inflate.close(),this._inflate=null,n(o);return}let s=Ha.concat(this._inflate[qe],this._inflate[Oe]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[Oe]=0,this._inflate[qe]=[],r&&this.params[`${i}_no_context_takeover`]&&this._inflate.reset()),n(null,s)})}_compress(e,r,n){let i=this._isServer?"server":"client";if(!this._deflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?Rt.Z_DEFAULT_WINDOWBITS:this.params[o];this._deflate=Rt.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:s}),this._deflate[Oe]=0,this._deflate[qe]=[],this._deflate.on("data",Am)}this._deflate[$t]=n,this._deflate.write(e),this._deflate.flush(Rt.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let o=Ha.concat(this._deflate[qe],this._deflate[Oe]);r&&(o=new Dm(o.buffer,o.byteOffset,o.length-4)),this._deflate[$t]=null,this._deflate[Oe]=0,this._deflate[qe]=[],r&&this.params[`${i}_no_context_takeover`]&&this._deflate.reset(),n(null,o)})}};za.exports=Gn;function Am(t){this[qe].push(t),this[Oe]+=t.length}function Ja(t){if(this[Oe]+=t.length,this[kr]._maxPayload<1||this[Oe]<=this[kr]._maxPayload){this[qe].push(t);return}this[br]=new RangeError("Max payload size exceeded"),this[br].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[br][Ga]=1009,this.removeListener("data",Ja),this.reset()}function Rm(t){this[kr]._inflate=null,t[Ga]=1007,this[$t](t)}});var Ka=w((xw,Ya)=>{"use strict";function $m(t){let e=t.length,r=0;for(;r<e;)if(!(t[r]&128))r++;else if((t[r]&224)===192){if(r+1===e||(t[r+1]&192)!==128||(t[r]&254)===192)return!1;r+=2}else if((t[r]&240)===224){if(r+2>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||t[r]===224&&(t[r+1]&224)===128||t[r]===237&&(t[r+1]&224)===160)return!1;r+=3}else if((t[r]&248)===240){if(r+3>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||(t[r+3]&192)!==128||t[r]===240&&(t[r+1]&240)===128||t[r]===244&&t[r+1]>143||t[r]>244)return!1;r+=4}else return!1;return!0}Ya.exports=$m});var Xa=w((Sw,Jn)=>{"use strict";try{Jn.exports=jn()(__dirname)}catch{Jn.exports=Ka()}});var jt=w((Ew,Cr)=>{"use strict";var{isUtf8:Qa}=v("buffer"),Bm=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function jm(t){return t>=1e3&&t<=1014&&t!==1004&&t!==1005&&t!==1006||t>=3e3&&t<=4999}function zn(t){let e=t.length,r=0;for(;r<e;)if(!(t[r]&128))r++;else if((t[r]&224)===192){if(r+1===e||(t[r+1]&192)!==128||(t[r]&254)===192)return!1;r+=2}else if((t[r]&240)===224){if(r+2>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||t[r]===224&&(t[r+1]&224)===128||t[r]===237&&(t[r+1]&224)===160)return!1;r+=3}else if((t[r]&248)===240){if(r+3>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||(t[r+3]&192)!==128||t[r]===240&&(t[r+1]&240)===128||t[r]===244&&t[r+1]>143||t[r]>244)return!1;r+=4}else return!1;return!0}Cr.exports={isValidStatusCode:jm,isValidUTF8:zn,tokenChars:Bm};if(Qa)Cr.exports.isValidUTF8=function(t){return t.length<24?zn(t):Qa(t)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let t=Xa();Cr.exports.isValidUTF8=function(e){return e.length<32?zn(e):t(e)}}catch{}});var Qn=w((Pw,oc)=>{"use strict";var{Writable:Um}=v("stream"),Za=Bt(),{BINARY_TYPES:qm,EMPTY_BUFFER:ec,kStatusCode:Wm,kWebSocket:Vm}=Ue(),{concat:Yn,toArrayBuffer:Hm,unmask:Gm}=At(),{isValidStatusCode:Jm,isValidUTF8:tc}=jt(),Or=Buffer[Symbol.species],Ut=0,rc=1,nc=2,ic=3,Kn=4,zm=5,Xn=class extends Um{constructor(e={}){super(),this._binaryType=e.binaryType||qm[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[Vm]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=Ut,this._loop=!1}_write(e,r,n){if(this._opcode===8&&this._state==Ut)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let n=this._buffers[0];return this._buffers[0]=new Or(n.buffer,n.byteOffset+e,n.length-e),new Or(n.buffer,n.byteOffset,e)}let r=Buffer.allocUnsafe(e);do{let n=this._buffers[0],i=r.length-e;e>=n.length?r.set(this._buffers.shift(),i):(r.set(new Uint8Array(n.buffer,n.byteOffset,e),i),this._buffers[0]=new Or(n.buffer,n.byteOffset+e,n.length-e)),e-=n.length}while(e>0);return r}startLoop(e){let r;this._loop=!0;do switch(this._state){case Ut:r=this.getInfo();break;case rc:r=this.getPayloadLength16();break;case nc:r=this.getPayloadLength64();break;case ic:this.getMask();break;case Kn:r=this.getData(e);break;default:this._loop=!1;return}while(this._loop);e(r)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}let e=this.consume(2);if(e[0]&48)return this._loop=!1,q(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");let r=(e[0]&64)===64;if(r&&!this._extensions[Za.extensionName])return this._loop=!1,q(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=(e[0]&128)===128,this._opcode=e[0]&15,this._payloadLength=e[1]&127,this._opcode===0){if(r)return this._loop=!1,q(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,q(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,q(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=r}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,q(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(r)return this._loop=!1,q(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1)return this._loop=!1,q(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}else return this._loop=!1,q(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(e[1]&128)===128,this._isServer){if(!this._masked)return this._loop=!1,q(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,q(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(this._payloadLength===126)this._state=rc;else if(this._payloadLength===127)this._state=nc;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}let e=this.consume(8),r=e.readUInt32BE(0);return r>Math.pow(2,53-32)-1?(this._loop=!1,q(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=r*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,q(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=ic:this._state=Kn}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=Kn}getData(e){let r=ec;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}r=this.consume(this._payloadLength),this._masked&&this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3]&&Gm(r,this._mask)}if(this._opcode>7)return this.controlMessage(r);if(this._compressed){this._state=zm,this.decompress(r,e);return}return r.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(r)),this.dataMessage()}decompress(e,r){this._extensions[Za.extensionName].decompress(e,this._fin,(i,o)=>{if(i)return r(i);if(o.length){if(this._messageLength+=o.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return r(q(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(o)}let s=this.dataMessage();if(s)return r(s);this.startLoop(r)})}dataMessage(){if(this._fin){let e=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let n;this._binaryType==="nodebuffer"?n=Yn(r,e):this._binaryType==="arraybuffer"?n=Hm(Yn(r,e)):n=r,this.emit("message",n,!0)}else{let n=Yn(r,e);if(!this._skipUTF8Validation&&!tc(n))return this._loop=!1,q(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",n,!1)}}this._state=Ut}controlMessage(e){if(this._opcode===8)if(this._loop=!1,e.length===0)this.emit("conclude",1005,ec),this.end();else{let r=e.readUInt16BE(0);if(!Jm(r))return q(RangeError,`invalid status code ${r}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");let n=new Or(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!tc(n))return q(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",r,n),this.end()}else this._opcode===9?this.emit("ping",e):this.emit("pong",e);this._state=Ut}};oc.exports=Xn;function q(t,e,r,n,i){let o=new t(r?`Invalid WebSocket frame: ${e}`:e);return Error.captureStackTrace(o,q),o.code=i,o[Wm]=n,o}});var ei=w((Cw,cc)=>{"use strict";var bw=v("net"),kw=v("tls"),{randomFillSync:Ym}=v("crypto"),sc=Bt(),{EMPTY_BUFFER:Km}=Ue(),{isValidStatusCode:Xm}=jt(),{mask:ac,toBuffer:ht}=At(),ge=Symbol("kByteLength"),Qm=Buffer.alloc(4),Zn=class t{constructor(e,r,n){this._extensions=r||{},n&&(this._generateMask=n,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,r){let n,i=!1,o=2,s=!1;r.mask&&(n=r.maskBuffer||Qm,r.generateMask?r.generateMask(n):Ym(n,0,4),s=(n[0]|n[1]|n[2]|n[3])===0,o=6);let a;typeof e=="string"?(!r.mask||s)&&r[ge]!==void 0?a=r[ge]:(e=Buffer.from(e),a=e.length):(a=e.length,i=r.mask&&r.readOnly&&!s);let l=a;a>=65536?(o+=8,l=127):a>125&&(o+=2,l=126);let u=Buffer.allocUnsafe(i?a+o:o);return u[0]=r.fin?r.opcode|128:r.opcode,r.rsv1&&(u[0]|=64),u[1]=l,l===126?u.writeUInt16BE(a,2):l===127&&(u[2]=u[3]=0,u.writeUIntBE(a,4,6)),r.mask?(u[1]|=128,u[o-4]=n[0],u[o-3]=n[1],u[o-2]=n[2],u[o-1]=n[3],s?[u,e]:i?(ac(e,n,u,o,a),[u]):(ac(e,n,e,0,a),[u,e])):[u,e]}close(e,r,n,i){let o;if(e===void 0)o=Km;else{if(typeof e!="number"||!Xm(e))throw new TypeError("First argument must be a valid error code number");if(r===void 0||!r.length)o=Buffer.allocUnsafe(2),o.writeUInt16BE(e,0);else{let a=Buffer.byteLength(r);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");o=Buffer.allocUnsafe(2+a),o.writeUInt16BE(e,0),typeof r=="string"?o.write(r,2):o.set(r,2)}}let s={[ge]:o.length,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,o,!1,s,i]):this.sendFrame(t.frame(o,s),i)}ping(e,r,n){let i,o;if(typeof e=="string"?(i=Buffer.byteLength(e),o=!1):(e=ht(e),i=e.length,o=ht.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");let s={[ge]:i,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:9,readOnly:o,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,s,n]):this.sendFrame(t.frame(e,s),n)}pong(e,r,n){let i,o;if(typeof e=="string"?(i=Buffer.byteLength(e),o=!1):(e=ht(e),i=e.length,o=ht.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");let s={[ge]:i,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:10,readOnly:o,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,s,n]):this.sendFrame(t.frame(e,s),n)}send(e,r,n){let i=this._extensions[sc.extensionName],o=r.binary?2:1,s=r.compress,a,l;if(typeof e=="string"?(a=Buffer.byteLength(e),l=!1):(e=ht(e),a=e.length,l=ht.readOnly),this._firstFragment?(this._firstFragment=!1,s&&i&&i.params[i._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(s=a>=i._threshold),this._compress=s):(s=!1,o=0),r.fin&&(this._firstFragment=!0),i){let u={[ge]:a,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:o,readOnly:l,rsv1:s};this._deflating?this.enqueue([this.dispatch,e,this._compress,u,n]):this.dispatch(e,this._compress,u,n)}else this.sendFrame(t.frame(e,{[ge]:a,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:o,readOnly:l,rsv1:!1}),n)}dispatch(e,r,n,i){if(!r){this.sendFrame(t.frame(e,n),i);return}let o=this._extensions[sc.extensionName];this._bufferedBytes+=n[ge],this._deflating=!0,o.compress(e,n.fin,(s,a)=>{if(this._socket.destroyed){let l=new Error("The socket was closed while data was being compressed");typeof i=="function"&&i(l);for(let u=0;u<this._queue.length;u++){let c=this._queue[u],f=c[c.length-1];typeof f=="function"&&f(l)}return}this._bufferedBytes-=n[ge],this._deflating=!1,n.readOnly=!1,this.sendFrame(t.frame(a,n),i),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][ge],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][ge],this._queue.push(e)}sendFrame(e,r){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],r),this._socket.uncork()):this._socket.write(e[0],r)}};cc.exports=Zn});var yc=w((Ow,gc)=>{"use strict";var{kForOnEventAttribute:qt,kListener:ti}=Ue(),lc=Symbol("kCode"),uc=Symbol("kData"),fc=Symbol("kError"),pc=Symbol("kMessage"),mc=Symbol("kReason"),gt=Symbol("kTarget"),dc=Symbol("kType"),hc=Symbol("kWasClean"),Le=class{constructor(e){this[gt]=null,this[dc]=e}get target(){return this[gt]}get type(){return this[dc]}};Object.defineProperty(Le.prototype,"target",{enumerable:!0});Object.defineProperty(Le.prototype,"type",{enumerable:!0});var tt=class extends Le{constructor(e,r={}){super(e),this[lc]=r.code===void 0?0:r.code,this[mc]=r.reason===void 0?"":r.reason,this[hc]=r.wasClean===void 0?!1:r.wasClean}get code(){return this[lc]}get reason(){return this[mc]}get wasClean(){return this[hc]}};Object.defineProperty(tt.prototype,"code",{enumerable:!0});Object.defineProperty(tt.prototype,"reason",{enumerable:!0});Object.defineProperty(tt.prototype,"wasClean",{enumerable:!0});var yt=class extends Le{constructor(e,r={}){super(e),this[fc]=r.error===void 0?null:r.error,this[pc]=r.message===void 0?"":r.message}get error(){return this[fc]}get message(){return this[pc]}};Object.defineProperty(yt.prototype,"error",{enumerable:!0});Object.defineProperty(yt.prototype,"message",{enumerable:!0});var Wt=class extends Le{constructor(e,r={}){super(e),this[uc]=r.data===void 0?null:r.data}get data(){return this[uc]}};Object.defineProperty(Wt.prototype,"data",{enumerable:!0});var Zm={addEventListener(t,e,r={}){for(let i of this.listeners(t))if(!r[qt]&&i[ti]===e&&!i[qt])return;let n;if(t==="message")n=function(o,s){let a=new Wt("message",{data:s?o:o.toString()});a[gt]=this,Lr(e,this,a)};else if(t==="close")n=function(o,s){let a=new tt("close",{code:o,reason:s.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[gt]=this,Lr(e,this,a)};else if(t==="error")n=function(o){let s=new yt("error",{error:o,message:o.message});s[gt]=this,Lr(e,this,s)};else if(t==="open")n=function(){let o=new Le("open");o[gt]=this,Lr(e,this,o)};else return;n[qt]=!!r[qt],n[ti]=e,r.once?this.once(t,n):this.on(t,n)},removeEventListener(t,e){for(let r of this.listeners(t))if(r[ti]===e&&!r[qt]){this.removeListener(t,r);break}}};gc.exports={CloseEvent:tt,ErrorEvent:yt,Event:Le,EventTarget:Zm,MessageEvent:Wt};function Lr(t,e,r){typeof t=="object"&&t.handleEvent?t.handleEvent.call(t,r):t.call(e,r)}});var ri=w((Lw,_c)=>{"use strict";var{tokenChars:Vt}=jt();function Se(t,e,r){t[e]===void 0?t[e]=[r]:t[e].push(r)}function ed(t){let e=Object.create(null),r=Object.create(null),n=!1,i=!1,o=!1,s,a,l=-1,u=-1,c=-1,f=0;for(;f<t.length;f++)if(u=t.charCodeAt(f),s===void 0)if(c===-1&&Vt[u]===1)l===-1&&(l=f);else if(f!==0&&(u===32||u===9))c===-1&&l!==-1&&(c=f);else if(u===59||u===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${f}`);c===-1&&(c=f);let m=t.slice(l,c);u===44?(Se(e,m,r),r=Object.create(null)):s=m,l=c=-1}else throw new SyntaxError(`Unexpected character at index ${f}`);else if(a===void 0)if(c===-1&&Vt[u]===1)l===-1&&(l=f);else if(u===32||u===9)c===-1&&l!==-1&&(c=f);else if(u===59||u===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${f}`);c===-1&&(c=f),Se(r,t.slice(l,c),!0),u===44&&(Se(e,s,r),r=Object.create(null),s=void 0),l=c=-1}else if(u===61&&l!==-1&&c===-1)a=t.slice(l,f),l=c=-1;else throw new SyntaxError(`Unexpected character at index ${f}`);else if(i){if(Vt[u]!==1)throw new SyntaxError(`Unexpected character at index ${f}`);l===-1?l=f:n||(n=!0),i=!1}else if(o)if(Vt[u]===1)l===-1&&(l=f);else if(u===34&&l!==-1)o=!1,c=f;else if(u===92)i=!0;else throw new SyntaxError(`Unexpected character at index ${f}`);else if(u===34&&t.charCodeAt(f-1)===61)o=!0;else if(c===-1&&Vt[u]===1)l===-1&&(l=f);else if(l!==-1&&(u===32||u===9))c===-1&&(c=f);else if(u===59||u===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${f}`);c===-1&&(c=f);let m=t.slice(l,c);n&&(m=m.replace(/\\/g,""),n=!1),Se(r,a,m),u===44&&(Se(e,s,r),r=Object.create(null),s=void 0),a=void 0,l=c=-1}else throw new SyntaxError(`Unexpected character at index ${f}`);if(l===-1||o||u===32||u===9)throw new SyntaxError("Unexpected end of input");c===-1&&(c=f);let p=t.slice(l,c);return s===void 0?Se(e,p,r):(a===void 0?Se(r,p,!0):n?Se(r,a,p.replace(/\\/g,"")):Se(r,a,p),Se(e,s,r)),e}function td(t){return Object.keys(t).map(e=>{let r=t[e];return Array.isArray(r)||(r=[r]),r.map(n=>[e].concat(Object.keys(n).map(i=>{let o=n[i];return Array.isArray(o)||(o=[o]),o.map(s=>s===!0?i:`${i}=${s}`).join("; ")})).join("; ")).join(", ")}).join(", ")}_c.exports={format:td,parse:ed}});var ai=w((Tw,Lc)=>{"use strict";var rd=v("events"),nd=v("https"),id=v("http"),xc=v("net"),od=v("tls"),{randomBytes:sd,createHash:ad}=v("crypto"),{Readable:Nw}=v("stream"),{URL:ni}=v("url"),We=Bt(),cd=Qn(),ld=ei(),{BINARY_TYPES:wc,EMPTY_BUFFER:Nr,GUID:ud,kForOnEventAttribute:ii,kListener:fd,kStatusCode:pd,kWebSocket:z,NOOP:Sc}=Ue(),{EventTarget:{addEventListener:md,removeEventListener:dd}}=yc(),{format:hd,parse:gd}=ri(),{toBuffer:yd}=At(),_d=30*1e3,Ec=Symbol("kAborted"),oi=[8,13],Ne=["CONNECTING","OPEN","CLOSING","CLOSED"],wd=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,R=class t extends rd{constructor(e,r,n){super(),this._binaryType=wc[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Nr,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=t.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,r===void 0?r=[]:Array.isArray(r)||(typeof r=="object"&&r!==null?(n=r,r=[]):r=[r]),Pc(this,e,r,n)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(e){wc.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,r,n){let i=new cd({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation});this._sender=new ld(e,this._extensions,n.generateMask),this._receiver=i,this._socket=e,i[z]=this,e[z]=this,i.on("conclude",Sd),i.on("drain",Ed),i.on("error",Pd),i.on("message",bd),i.on("ping",kd),i.on("pong",Cd),e.setTimeout(0),e.setNoDelay(),r.length>0&&e.unshift(r),e.on("close",kc),e.on("data",Mr),e.on("end",Cc),e.on("error",Oc),this._readyState=t.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[We.extensionName]&&this._extensions[We.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,r){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){let n="WebSocket was closed before the connection was established";oe(this,this._req,n);return}if(this.readyState===t.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=t.CLOSING,this._sender.close(e,r,!this._isServer,n=>{n||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),_d)}}pause(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=r=void 0):typeof r=="function"&&(n=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){si(this,e,n);return}r===void 0&&(r=!this._isServer),this._sender.ping(e||Nr,r,n)}pong(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=r=void 0):typeof r=="function"&&(n=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){si(this,e,n);return}r===void 0&&(r=!this._isServer),this._sender.pong(e||Nr,r,n)}resume(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"&&(n=r,r={}),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){si(this,e,n);return}let i={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...r};this._extensions[We.extensionName]||(i.compress=!1),this._sender.send(e||Nr,i,n)}terminate(){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){let e="WebSocket was closed before the connection was established";oe(this,this._req,e);return}this._socket&&(this._readyState=t.CLOSING,this._socket.destroy())}}};Object.defineProperty(R,"CONNECTING",{enumerable:!0,value:Ne.indexOf("CONNECTING")});Object.defineProperty(R.prototype,"CONNECTING",{enumerable:!0,value:Ne.indexOf("CONNECTING")});Object.defineProperty(R,"OPEN",{enumerable:!0,value:Ne.indexOf("OPEN")});Object.defineProperty(R.prototype,"OPEN",{enumerable:!0,value:Ne.indexOf("OPEN")});Object.defineProperty(R,"CLOSING",{enumerable:!0,value:Ne.indexOf("CLOSING")});Object.defineProperty(R.prototype,"CLOSING",{enumerable:!0,value:Ne.indexOf("CLOSING")});Object.defineProperty(R,"CLOSED",{enumerable:!0,value:Ne.indexOf("CLOSED")});Object.defineProperty(R.prototype,"CLOSED",{enumerable:!0,value:Ne.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(t=>{Object.defineProperty(R.prototype,t,{enumerable:!0})});["open","error","close","message"].forEach(t=>{Object.defineProperty(R.prototype,`on${t}`,{enumerable:!0,get(){for(let e of this.listeners(t))if(e[ii])return e[fd];return null},set(e){for(let r of this.listeners(t))if(r[ii]){this.removeListener(t,r);break}typeof e=="function"&&this.addEventListener(t,e,{[ii]:!0})}})});R.prototype.addEventListener=md;R.prototype.removeEventListener=dd;Lc.exports=R;function Pc(t,e,r,n){let i={protocolVersion:oi[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...n,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(!oi.includes(i.protocolVersion))throw new RangeError(`Unsupported protocol version: ${i.protocolVersion} (supported versions: ${oi.join(", ")})`);let o;if(e instanceof ni)o=e,t._url=e.href;else{try{o=new ni(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}t._url=e}let s=o.protocol==="wss:",a=o.protocol==="ws+unix:",l;if(o.protocol!=="ws:"&&!s&&!a?l=`The URL's protocol must be one of "ws:", "wss:", or "ws+unix:"`:a&&!o.pathname?l="The URL's pathname is empty":o.hash&&(l="The URL contains a fragment identifier"),l){let g=new SyntaxError(l);if(t._redirects===0)throw g;Tr(t,g);return}let u=s?443:80,c=sd(16).toString("base64"),f=s?nd.request:id.request,p=new Set,m;if(i.createConnection=s?xd:vd,i.defaultPort=i.defaultPort||u,i.port=o.port||u,i.host=o.hostname.startsWith("[")?o.hostname.slice(1,-1):o.hostname,i.headers={...i.headers,"Sec-WebSocket-Version":i.protocolVersion,"Sec-WebSocket-Key":c,Connection:"Upgrade",Upgrade:"websocket"},i.path=o.pathname+o.search,i.timeout=i.handshakeTimeout,i.perMessageDeflate&&(m=new We(i.perMessageDeflate!==!0?i.perMessageDeflate:{},!1,i.maxPayload),i.headers["Sec-WebSocket-Extensions"]=hd({[We.extensionName]:m.offer()})),r.length){for(let g of r){if(typeof g!="string"||!wd.test(g)||p.has(g))throw new SyntaxError("An invalid or duplicated subprotocol was specified");p.add(g)}i.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(i.origin&&(i.protocolVersion<13?i.headers["Sec-WebSocket-Origin"]=i.origin:i.headers.Origin=i.origin),(o.username||o.password)&&(i.auth=`${o.username}:${o.password}`),a){let g=i.path.split(":");i.socketPath=g[0],i.path=g[1]}let h;if(i.followRedirects){if(t._redirects===0){t._originalIpc=a,t._originalSecure=s,t._originalHostOrSocketPath=a?i.socketPath:o.host;let g=n&&n.headers;if(n={...n,headers:{}},g)for(let[_,S]of Object.entries(g))n.headers[_.toLowerCase()]=S}else if(t.listenerCount("redirect")===0){let g=a?t._originalIpc?i.socketPath===t._originalHostOrSocketPath:!1:t._originalIpc?!1:o.host===t._originalHostOrSocketPath;(!g||t._originalSecure&&!s)&&(delete i.headers.authorization,delete i.headers.cookie,g||delete i.headers.host,i.auth=void 0)}i.auth&&!n.headers.authorization&&(n.headers.authorization="Basic "+Buffer.from(i.auth).toString("base64")),h=t._req=f(i),t._redirects&&t.emit("redirect",t.url,h)}else h=t._req=f(i);i.timeout&&h.on("timeout",()=>{oe(t,h,"Opening handshake has timed out")}),h.on("error",g=>{h===null||h[Ec]||(h=t._req=null,Tr(t,g))}),h.on("response",g=>{let _=g.headers.location,S=g.statusCode;if(_&&i.followRedirects&&S>=300&&S<400){if(++t._redirects>i.maxRedirects){oe(t,h,"Maximum redirects exceeded");return}h.abort();let C;try{C=new ni(_,e)}catch{let W=new SyntaxError(`Invalid URL: ${_}`);Tr(t,W);return}Pc(t,C,r,n)}else t.emit("unexpected-response",h,g)||oe(t,h,`Unexpected server response: ${g.statusCode}`)}),h.on("upgrade",(g,_,S)=>{if(t.emit("upgrade",g),t.readyState!==R.CONNECTING)return;if(h=t._req=null,g.headers.upgrade.toLowerCase()!=="websocket"){oe(t,_,"Invalid Upgrade header");return}let C=ad("sha1").update(c+ud).digest("base64");if(g.headers["sec-websocket-accept"]!==C){oe(t,_,"Invalid Sec-WebSocket-Accept header");return}let O=g.headers["sec-websocket-protocol"],W;if(O!==void 0?p.size?p.has(O)||(W="Server sent an invalid subprotocol"):W="Server sent a subprotocol but none was requested":p.size&&(W="Server sent no subprotocol"),W){oe(t,_,W);return}O&&(t._protocol=O);let Ie=g.headers["sec-websocket-extensions"];if(Ie!==void 0){if(!m){oe(t,_,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let be;try{be=gd(Ie)}catch{oe(t,_,"Invalid Sec-WebSocket-Extensions header");return}let Ye=Object.keys(be);if(Ye.length!==1||Ye[0]!==We.extensionName){oe(t,_,"Server indicated an extension that was not requested");return}try{m.accept(be[We.extensionName])}catch{oe(t,_,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[We.extensionName]=m}t.setSocket(_,S,{generateMask:i.generateMask,maxPayload:i.maxPayload,skipUTF8Validation:i.skipUTF8Validation})}),i.finishRequest?i.finishRequest(h,t):h.end()}function Tr(t,e){t._readyState=R.CLOSING,t.emit("error",e),t.emitClose()}function vd(t){return t.path=t.socketPath,xc.connect(t)}function xd(t){return t.path=void 0,!t.servername&&t.servername!==""&&(t.servername=xc.isIP(t.host)?"":t.host),od.connect(t)}function oe(t,e,r){t._readyState=R.CLOSING;let n=new Error(r);Error.captureStackTrace(n,oe),e.setHeader?(e[Ec]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(Tr,t,n)):(e.destroy(n),e.once("error",t.emit.bind(t,"error")),e.once("close",t.emitClose.bind(t)))}function si(t,e,r){if(e){let n=yd(e).length;t._socket?t._sender._bufferedBytes+=n:t._bufferedAmount+=n}if(r){let n=new Error(`WebSocket is not open: readyState ${t.readyState} (${Ne[t.readyState]})`);process.nextTick(r,n)}}function Sd(t,e){let r=this[z];r._closeFrameReceived=!0,r._closeMessage=e,r._closeCode=t,r._socket[z]!==void 0&&(r._socket.removeListener("data",Mr),process.nextTick(bc,r._socket),t===1005?r.close():r.close(t,e))}function Ed(){let t=this[z];t.isPaused||t._socket.resume()}function Pd(t){let e=this[z];e._socket[z]!==void 0&&(e._socket.removeListener("data",Mr),process.nextTick(bc,e._socket),e.close(t[pd])),e.emit("error",t)}function vc(){this[z].emitClose()}function bd(t,e){this[z].emit("message",t,e)}function kd(t){let e=this[z];e.pong(t,!e._isServer,Sc),e.emit("ping",t)}function Cd(t){this[z].emit("pong",t)}function bc(t){t.resume()}function kc(){let t=this[z];this.removeListener("close",kc),this.removeListener("data",Mr),this.removeListener("end",Cc),t._readyState=R.CLOSING;let e;!this._readableState.endEmitted&&!t._closeFrameReceived&&!t._receiver._writableState.errorEmitted&&(e=t._socket.read())!==null&&t._receiver.write(e),t._receiver.end(),this[z]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",vc),t._receiver.on("finish",vc))}function Mr(t){this[z]._receiver.write(t)||this.pause()}function Cc(){let t=this[z];t._readyState=R.CLOSING,t._receiver.end(),this.end()}function Oc(){let t=this[z];this.removeListener("error",Oc),this.on("error",Sc),t&&(t._readyState=R.CLOSING,this.destroy())}});var Tc=w((Mw,Nc)=>{"use strict";var{tokenChars:Od}=jt();function Ld(t){let e=new Set,r=-1,n=-1,i=0;for(i;i<t.length;i++){let s=t.charCodeAt(i);if(n===-1&&Od[s]===1)r===-1&&(r=i);else if(i!==0&&(s===32||s===9))n===-1&&r!==-1&&(n=i);else if(s===44){if(r===-1)throw new SyntaxError(`Unexpected character at index ${i}`);n===-1&&(n=i);let a=t.slice(r,n);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),r=n=-1}else throw new SyntaxError(`Unexpected character at index ${i}`)}if(r===-1||n!==-1)throw new SyntaxError("Unexpected end of input");let o=t.slice(r,i);if(e.has(o))throw new SyntaxError(`The "${o}" subprotocol is duplicated`);return e.add(o),e}Nc.exports={parse:Ld}});var $c=w((Aw,Rc)=>{"use strict";var Nd=v("events"),Ir=v("http"),Iw=v("https"),Dw=v("net"),Fw=v("tls"),{createHash:Td}=v("crypto"),Mc=ri(),rt=Bt(),Md=Tc(),Id=ai(),{GUID:Dd,kWebSocket:Fd}=Ue(),Ad=/^[+/0-9A-Za-z]{22}==$/,Ic=0,Dc=1,Ac=2,ci=class extends Nd{constructor(e,r){if(super(),e={maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:Id,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=Ir.createServer((n,i)=>{let o=Ir.STATUS_CODES[426];i.writeHead(426,{"Content-Length":o.length,"Content-Type":"text/plain"}),i.end(o)}),this._server.listen(e.port,e.host,e.backlog,r)):e.server&&(this._server=e.server),this._server){let n=this.emit.bind(this,"connection");this._removeListeners=Rd(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(i,o,s)=>{this.handleUpgrade(i,o,s,n)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=Ic}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===Ac){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(Ht,this);return}if(e&&this.once("close",e),this._state!==Dc)if(this._state=Dc,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(Ht,this):process.nextTick(Ht,this);else{let r=this._server;this._removeListeners(),this._removeListeners=this._server=null,r.close(()=>{Ht(this)})}}shouldHandle(e){if(this.options.path){let r=e.url.indexOf("?");if((r!==-1?e.url.slice(0,r):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,r,n,i){r.on("error",Fc);let o=e.headers["sec-websocket-key"],s=+e.headers["sec-websocket-version"];if(e.method!=="GET"){nt(this,e,r,405,"Invalid HTTP method");return}if(e.headers.upgrade.toLowerCase()!=="websocket"){nt(this,e,r,400,"Invalid Upgrade header");return}if(!o||!Ad.test(o)){nt(this,e,r,400,"Missing or invalid Sec-WebSocket-Key header");return}if(s!==8&&s!==13){nt(this,e,r,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(e)){Gt(r,400);return}let a=e.headers["sec-websocket-protocol"],l=new Set;if(a!==void 0)try{l=Md.parse(a)}catch{nt(this,e,r,400,"Invalid Sec-WebSocket-Protocol header");return}let u=e.headers["sec-websocket-extensions"],c={};if(this.options.perMessageDeflate&&u!==void 0){let f=new rt(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let p=Mc.parse(u);p[rt.extensionName]&&(f.accept(p[rt.extensionName]),c[rt.extensionName]=f)}catch{nt(this,e,r,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let f={origin:e.headers[`${s===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(f,(p,m,h,g)=>{if(!p)return Gt(r,m||401,h,g);this.completeUpgrade(c,o,l,e,r,n,i)});return}if(!this.options.verifyClient(f))return Gt(r,401)}this.completeUpgrade(c,o,l,e,r,n,i)}completeUpgrade(e,r,n,i,o,s,a){if(!o.readable||!o.writable)return o.destroy();if(o[Fd])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>Ic)return Gt(o,503);let u=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Td("sha1").update(r+Dd).digest("base64")}`],c=new this.options.WebSocket(null);if(n.size){let f=this.options.handleProtocols?this.options.handleProtocols(n,i):n.values().next().value;f&&(u.push(`Sec-WebSocket-Protocol: ${f}`),c._protocol=f)}if(e[rt.extensionName]){let f=e[rt.extensionName].params,p=Mc.format({[rt.extensionName]:[f]});u.push(`Sec-WebSocket-Extensions: ${p}`),c._extensions=e}this.emit("headers",u,i),o.write(u.concat(`\r
`).join(`\r
`)),o.removeListener("error",Fc),c.setSocket(o,s,{maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(c),c.on("close",()=>{this.clients.delete(c),this._shouldEmitClose&&!this.clients.size&&process.nextTick(Ht,this)})),a(c,i)}};Rc.exports=ci;function Rd(t,e){for(let r of Object.keys(e))t.on(r,e[r]);return function(){for(let n of Object.keys(e))t.removeListener(n,e[n])}}function Ht(t){t._state=Ac,t.emit("close")}function Fc(){this.destroy()}function Gt(t,e,r,n){r=r||Ir.STATUS_CODES[e],n={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...n},t.once("finish",t.destroy),t.end(`HTTP/1.1 ${e} ${Ir.STATUS_CODES[e]}\r
`+Object.keys(n).map(i=>`${i}: ${n[i]}`).join(`\r
`)+`\r
\r
`+r)}function nt(t,e,r,n,i){if(t.listenerCount("wsClientError")){let o=new Error(i);Error.captureStackTrace(o,nt),t.emit("wsClientError",o,r,e)}else Gt(r,n,i)}});var $d,Bd,jd,li,ui,Bc=y(()=>{$d=A(wa(),1),Bd=A(Qn(),1),jd=A(ei(),1),li=A(ai(),1),ui=A($c(),1)});var jc=y(()=>{});var Ud,Dr,fi,qc,pi=y(()=>{Bc();jc();Ud=(t,e)=>{let r=new ui.default({host:t,port:e+1});return{broadcast:i=>{for(let o of r.clients)o.readyState===li.default.OPEN&&o.send(JSON.stringify({type:i}))}}},fi=(t="localhost",e)=>{if(process.env.NODE_ENV==="production")return null;if(Dr)return Dr;if(!e)throw new Error("HMR port is not provided");return Dr=Ud(t,e),Dr},qc=t=>{if(process.env.NODE_ENV==="production")return;let e=fi();e&&e.broadcast(t)}});var _t,Fr=y(()=>{st();_t=()=>{let t=Fe(),{target:e,tag:r}=t,[n,i]=e.split("-");return{tag:r,target:e,browser:n,manifestVersion:i}}});import{AssertionError as qd}from"assert";function wt(t){throw new Error("Statement should be unreachable")}function mi(t,e="Value is invalid"){if(!t)throw new qd({message:e});return t}var Jt=y(()=>{});function zd(t){switch(t){case 0:return"Web";case 1:case 2:case 3:return Gc[t];default:wt(t)}}var hi,Rr,gi,zt,Wd,Vd,Wc,Hd,Gd,Jd,di,yi,He,Ge,se,Vc,Hc,Jw,Gc,Ar,zw,Yw,Jc,zc,Kw,Ee,Ve,Yd,Xw,Kd,Qw,Zw,ev,tv,Yc=y(()=>{Jt();hi="en",Rr=!1,gi=!1,zt=!1,Wd=!1,Vd=!1,Wc=!1,Hd=!1,Gd=!1,Jd=!1,yi=hi,Ge=typeof self=="object"?self:typeof global=="object"?global:{};typeof Ge.vscode<"u"&&typeof Ge.vscode.process<"u"?se=Ge.vscode.process:typeof process<"u"&&(se=process);Vc=typeof se?.versions?.electron=="string",Hc=Vc&&se?.type==="renderer",Jw=Hc&&se?.sandboxed;typeof navigator=="object"&&!Hc?(He=navigator.userAgent,Rr=He.indexOf("Windows")>=0,gi=He.indexOf("Macintosh")>=0,Gd=(He.indexOf("Macintosh")>=0||He.indexOf("iPad")>=0||He.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,zt=He.indexOf("Linux")>=0,Wc=!0,di=navigator.language,yi=di):typeof se=="object"?(Rr=se.platform==="win32",gi=se.platform==="darwin",zt=se.platform==="linux",Wd=zt&&!!se.env.SNAP&&!!se.env.SNAP_REVISION,Hd=Vc,Jd=!!se.env.CI||!!se.env.BUILD_ARTIFACTSTAGINGDIRECTORY,di=hi,yi=hi,Vd=!0):console.error("Unable to resolve platform.");Gc={1:"Mac",2:"Linux",3:"Windows"};Ar=0;gi?Ar=1:Rr?Ar=3:zt&&(Ar=2);zw=Object.values(Gc),Yw=zd(Ar),Jc=Rr,zc=zt,Kw=Wc&&typeof Ge.importScripts=="function",Ee=He,Ve=yi;(n=>{function t(){return Ve}n.value=t;function e(){return Ve.length===2?Ve==="en":Ve.length>=3?Ve[0]==="e"&&Ve[1]==="n"&&Ve[2]==="-":!1}n.isDefaultVariant=e;function r(){return Ve==="en"}n.isDefault=r})(Yd||={});Xw=(()=>{if(typeof Ge.postMessage=="function"&&!Ge.importScripts){let t=[];Ge.addEventListener("message",r=>{if(r.data&&r.data.vscodeScheduleAsyncWork)for(let n=0,i=t.length;n<i;n++){let o=t[n];if(o.id===r.data.vscodeScheduleAsyncWork){t.splice(n,1),o.callback();return}}});let e=0;return r=>{let n=++e;t.push({id:n,callback:r}),Ge.postMessage({vscodeScheduleAsyncWork:n},"*")}}return t=>setTimeout(t)})(),Kd=!!(Ee&&Ee.indexOf("Chrome")>=0),Qw=!!(Ee&&Ee.indexOf("Firefox")>=0),Zw=!!(!Kd&&Ee&&Ee.indexOf("Safari")>=0),ev=!!(Ee&&Ee.indexOf("Edg/")>=0),tv=!!(Ee&&Ee.indexOf("Android")>=0)});var Kc,Xc=y(()=>{Yc();Kc=Jc?"windows":zc?"inotify":"fs-events"});async function Te(t,e){for(let r of t)if(await e(r))return r}var Yt=y(()=>{});import{basename as Xd,extname as Qc,posix as Qd,win32 as Zd}from"path";var ae,Zc,vt=y(()=>{ae=t=>t.replaceAll(Zd.sep,Qd.sep),Zc=t=>Qc(Xd(t,Qc(t)))});import{readFile as eh}from"fs/promises";import{resolve as th}from"path";import{constantCase as rh}from"change-case";import nh from"dotenv";import{expand as ih}from"dotenv-expand";function sh(t){let e=Object.assign({},process.env);for(let{contents:r,name:n}of t)try{tl.add(n);let i=ih({ignoreProcessEnv:!0,parsed:nh.parse(r)});if(i.parsed){d(`Loaded env from ${n}`);let o=i.parsed||{};for(let[s,a]of Object.entries(o))if(typeof e[s]>"u"){try{e[s]=ch(a)}catch(l){le(`Failed to parse JSON directive ${s} in ${n}:`,l.message)}s.startsWith(el)&&(process.env[s]=a)}}}catch(i){le(`Failed to load env from ${n}`,i)}return e}function ch(t){let e=t.match(ah);return e?JSON.parse(e[1]):t}async function rl(t){let e=await Promise.all(wi().map(o=>[o,th(t,o)]).map(async([o,s])=>[o,s,await sr(s)&&await or(s)])),r=await Promise.all(e.filter(([,,o])=>o).map(async([o,s])=>({name:o,contents:await eh(s,"utf8")}))),n=sh(r),i=new _i(n);return{combinedEnv:n,plasmoPublicEnv:i,loadedEnvFiles:r}}var el,oh,tl,_i,ah,wi,vi=y(()=>{Y();b();st();el="PLASMO_",oh="PLASMO_PUBLIC_",tl=new Set,_i=class t{data;constructor(e){this.data=Object.keys(e).filter(r=>r.startsWith(oh)).reduce((r,n)=>(r[n]=e[n],r),{})}extends(e){M("Loaded environment variables from:",[...tl]);let r=new t({...this.data});return r.data.NODE_ENV=process.env.NODE_ENV,Object.entries(e).forEach(([n,i])=>{r.data[`${el}${rh(n)}`]=i}),r}};ah=/^\s*json\((.+)\)\s*$/si;wi=()=>{let t=process.env.NODE_ENV,e=Fe();return[e.envPath,`.env.${e.browser}.local`,`.env.${e.tag}.local`,`.env.${t}.local`,t!=="test"?".env.local":"",`.env.${e.browser}`,`.env.${e.tag}`,`.env.${t}`,".env"].filter(r=>!!r)}});import{resolve as lh}from"path";async function il({commonPath:t,publicEnv:e}){let r=Object.keys(e.data);r.length!==0&&await(0,nl.outputFile)(lh(t.dotPlasmoDirectory,uh),fh(r))}var nl,xi,uh,fh,Si=y(()=>{nl=A(J(),1),xi="process.env",uh=`${xi}.d.ts`,fh=t=>`
declare namespace NodeJS {
  interface ProcessEnv {
${t.map(e=>`		${e}?: string`).join(`
`)}
  }
}
`});import ph from"typescript";var ye,Kt,ol=y(()=>{({SyntaxKind:ye}=ph),Kt=t=>{switch(t.kind){case ye.StringLiteral:return t.text;case ye.TrueKeyword:return!0;case ye.FalseKeyword:return!1;case ye.NullKeyword:return null;case ye.NumericLiteral:return parseFloat(t.text);case ye.ArrayLiteralExpression:return t.elements.filter(e=>e.kind!==ye.SpreadElement).map(Kt);case ye.ObjectLiteralExpression:return t.properties.filter(e=>e.kind===ye.PropertyAssignment&&(e.name.kind===ye.Identifier||e.name.kind===ye.StringLiteral)).map(e=>[e.name.escapedText||e.name.text,Kt(e.initializer)]).reduce((e,[r,n])=>({...e,[r]:n}),{});default:return}}});import{readFile as mh}from"fs/promises";import dh from"typescript";var hh,gh,yh,_h,wh,sl,al=y(()=>{b();ol();({ScriptTarget:hh,SyntaxKind:gh,createSourceFile:yh,isObjectLiteralExpression:_h,isVariableStatement:wh}=dh),sl=async t=>{try{let e=await mh(t,"utf8");if(e.length===0)return{isEmpty:!0};let n=yh(t,e,hh.Latest,!0).statements.filter(wh).reduce((s,a)=>(a.declarationList.forEachChild(l=>{s[l.name.getText()]=l.initializer}),s),{}),i=n.config;if(!i||!_h(i))return null;let o=i.properties.reduce((s,a)=>{if(a.getChildCount()<3)return s;let[l,u,c]=a.getChildren(),f=l.getText();try{c.kind===gh.Identifier?s[f]=Kt(n[c.getText()]):s[f]=Kt(c)}catch(p){le(p)}return s},{});return d("Parsed config:",o),{config:o}}catch(e){return d(e),null}}});import{basename as cl,resolve as Ei}from"path";import $r from"sharp";async function Br({assetsDirectory:t,genAssetsDirectory:e}){if(xt.baseIconPaths.length===0){let o=ll();xt.baseIconPaths=o.map(s=>Ei(t,s))}let r=await Te(xt.baseIconPaths,F);if(r===void 0){Z("No icon found in assets directory");return}await(0,Xt.ensureDir)(e);let i=await $r(r).toBuffer();d(`${r} found, creating resized icons`),await Promise.all(xh.map(async o=>{if(xt.devProvidedIcons[o]===void 0){let l=ll(Pi(o));xt.devProvidedIcons[o]=l.map(u=>Ei(t,u))}let s=await Te(xt.devProvidedIcons[o],F),a=Ei(e,`icon${o}.plasmo.png`);return process.env.NODE_ENV==="development"?s!==void 0?cl(s).includes(".development.")?(0,Xt.copy)(s,a):$r(s).grayscale().toFile(a):$r(Buffer.from(i)).resize({width:o,height:o}).greyscale(!cl(r).includes(".development.")).toFile(a):s!==void 0?(0,Xt.copy)(s,a):$r(Buffer.from(i)).resize({width:o,height:o}).toFile(a)}))}var Xt,Pi,vh,ll,xh,xt,bi=y(()=>{Xt=A(J(),1);Yt();Y();b();st();Pi=(t=512,e="icon")=>[`${e}${t}`,`${e}-${t}`,`${e}-${t}x${t}`],vh=["icon",...Pi(),...Pi(1024)],ll=(t=vh)=>{let e=Fe();return t.map(r=>[`${r}.${e.tag}.${process.env.NODE_ENV}.png`,`${r}.${process.env.NODE_ENV}.png`,`${r}.${e.tag}.png`,`${r}.png`]).flat()},xh=[128,64,48,32,16],xt={baseIconPaths:[],devProvidedIcons:{}}});import{resolve as ne}from"path";var ie,ul,ki=y(()=>{vi();ie=(t,e)=>t.reduce((r,n)=>(r[n]=e,r),{}),ul=({sourceDirectory:t,packageFilePath:e,assetsDirectory:r},n,i)=>{let o=P=>[".ts",...i,".js"].flatMap(L=>[ne(t,`${P}.${n}${L}`),ne(t,`${P}.${process.env.NODE_ENV}${L}`),ne(t,`${P}${L}`)]),s=(P,L=[".ts",".js"])=>L.flatMap(N=>[ne(t,`${P}.${n}${N}`),ne(t,P,`index.${n}${N}`),ne(t,`${P}.${process.env.NODE_ENV}${N}`),ne(t,P,`index.${process.env.NODE_ENV}${N}`),ne(t,`${P}${N}`),ne(t,P,`index${N}`)]),a=s("popup",i),l=s("options",i),u=s("devtools",i),c=s("newtab",i),f=s("sidepanel",i),p=s("popup",[".html"]),m=s("options",[".html"]),h=s("devtools",[".html"]),g=s("newtab",[".html"]),_=s("sidepanel",[".html"]),S=wi().map(P=>ne(t,P)),C=s("background"),O=o("content"),W=o("sandbox"),Ie={[e]:2,...ie(S,1),...ie(O,7),...ie(W,19),...ie(C,5),...ie(a,15),...ie(l,17),...ie(u,13),...ie(c,9),...ie(f,11),...ie(p,16),...ie(m,18),...ie(h,14),...ie(g,10),...ie(_,12)},be=ne(t,"contents"),Ye=ne(t,"sandboxes"),we=ne(t,"tabs"),x=ne(t,"background"),k=[[20,Ye],[4,we],[8,be],[6,x],[3,r]],E=new Set(Object.keys(Ie)),B=new Set([...C,...O,...W,...a,...l,...u,...c,...f]);return{popupIndexList:a,popupHtmlList:p,optionsIndexList:l,optionsHtmlList:m,devtoolsIndexList:u,devtoolsHtmlList:h,newtabIndexList:c,newtabHtmlList:g,backgroundIndexList:C,backgroundDirectory:x,contentIndexList:O,contentsDirectory:be,sidepanelIndexList:f,sidepanelHtmlList:_,sandboxIndexList:W,sandboxesDirectory:Ye,tabsDirectory:we,watchPathReasonMap:Ie,watchDirectoryEntries:k,isEntryPath:P=>B.has(P),knownPathSet:E}}});import{resolve as Sh}from"path";var fl,Ci,Eh,pl,ml,Oi=y(()=>{fl=A(J(),1),Ci="messaging",Eh=`${Ci}.d.ts`,pl=(t,e)=>(0,fl.outputFile)(Sh(t.dotPlasmoDirectory,Eh),e),ml=(t,e)=>`
import "@plasmohq/messaging"

interface MmMetadata {
	${t.join(`
	`)}
}

interface MpMetadata {
	${e.join(`
	`)}
}

declare module "@plasmohq/messaging" {
  interface MessagesMetadata extends MmMetadata {}
  interface PortsMetadata extends MpMetadata {}
}
`});import{readFile as Ph}from"fs/promises";import{resolve as hl}from"path";import bh from"json5";var jr,dl,kh,Ch,gl,yl=y(()=>{jr=A(J(),1);Oi();Si();dl=".plasmo/index.d.ts",kh=[xi,Ci].map(t=>`import "./${t}"`).join(`
`),Ch=async(t,e)=>{let r=hl(t.projectDirectory,"tsconfig.json"),n=await Ph(r,"utf8"),i=bh.parse(n),o=new Set(i.include);o.has(e)||(i.include=[e,...o],await(0,jr.outputJson)(r,i,{spaces:2}))},gl=async t=>{let e=hl(t.projectDirectory,dl);await Promise.all([(0,jr.outputFile)(e,kh),Ch(t,dl)])}});import{lstat as Oh}from"fs/promises";import{resolve as Lh}from"path";async function qr({dotPlasmoDirectory:t,cacheDirectory:e}){await(0,Ur.emptyDir)(t),await(0,Ur.ensureDir)(e)}async function _l(t){let e=Lh(t.cacheDirectory,"parcel","data.mdb");if(!await F(e))return;let i=(await Oh(e,{bigint:!0})).size/1024n**2n,o=Number(i)/1024;o>1.47&&(d(`Busting large build cache, size: ${o.toFixed(2)} GB`),await qr(t))}var Ur,Li=y(()=>{Ur=A(J(),1);Y();b()});import Nh from"package-json";import Ni from"semver";async function Th(t=""){switch((await ct()).name){case"npm":return`"npm i -S plasmo@${t}"`;case"pnpm":return`"pnpm i plasmo@${t}"`;case"yarn":return`"yarn add plasmo@${t}"`}}var Wr,wl,St,Qt=y(()=>{Wr=A(J(),1);Y();b();Li();cr();wl=async t=>{let{plasmoVersionFilePath:e}=t;if(!await F(e))d("Plasmo version file not found, busting cache..."),await qr(t);else{let r=await(0,Wr.readJson)(e),n=Ni.coerce(r.version),i=Ni.coerce("0.83.0");(!n||n.major<i.major||n.major===i.major&&n.minor<i.minor)&&(d("Plasmo updated, busting cache..."),await qr(t))}await(0,Wr.writeJson)(e,{version:"0.83.0"})},St=async()=>{let t="0.83.0";try{let r=(await Nh("plasmo",{version:"latest"})).version;if(Ni.lt(t,r)){let{default:n}=await import("chalk");Z(n.yellowBright(`A new version of plasmo is available: v${r}`));let i=await Th(r);qi(n.yellow(`Run ${i} to update`))}}catch(e){le('Error fetching package information for "plasmo"',e)}}});var Mh,Vr,vl=y(()=>{b();Mh=t=>M({target:t}),Vr=(t,e=Mh)=>{if(Array.isArray(t))return t.map(r=>Vr(r,e)).filter(r=>r!==void 0);if(typeof t=="object"){let r={};for(let n in t)t.hasOwnProperty(n)&&(r[n]=Vr(t[n],e),r[n]===void 0&&delete r[n]);return Object.keys(r).length===0?void 0:r}else return e(t)}});import{createHash as Ih}from"crypto";var Hr,Ti=y(()=>{Hr=t=>Ih("md5").update(t).digest("hex").slice(0,18)});import{resolve as El}from"path";import{cwd as Dh}from"process";import xl from"semver";var Pl,Fh,Ah,Rh,bl,Sl,$h,kl,Cl,Mi=y(()=>{Pl=A(J(),1);Jt();Y();Pe();Fh=["react","svelte","vue","vanilla"],Ah=[".tsx",".svelte",".vue",".jsx"],Rh=new Set(Ah),bl=t=>Rh.has(t),Sl="No supported UI library found.  You can file an RFC for a new UI Library here: https://github.com/PlasmoHQ/plasmo/issues",$h=async t=>{if(t.includes(":")){let[e,r]=t.split(":");switch(e){case"file":default:let n=await(0,Pl.readJson)(El(Dh(),r,"package.json"));return xl.coerce(n.version)?.major}}else return xl.coerce(t)?.major},kl=async t=>{let e=t.dependencies??{},r=Fh.find(s=>s in e);if(r===void 0)return{name:"vanilla",path:"vanilla",version:8427};let n=await $h(e[r]);if(n===void 0)throw new Error(Sl);if(r==="react"&&n<18)return{name:r,path:"react17",version:n};let i=`${r}${n}`,o=El(t.templatePath.staticTemplatePath,i);if(!await F(o))throw new Error(Sl);return{name:r,path:i,version:n}},Cl=t=>{switch(t){case"svelte":return{uiExts:[".svelte"],mountExt:".ts"};case"vue":return{uiExts:[".vue"],mountExt:".ts"};case"react":return{uiExts:[".tsx",".jsx"],mountExt:".tsx"};case"vanilla":return{uiExts:[".tsx",".jsx"],mountExt:".ts"};default:wt(t)}}});import{readFile as Ol,writeFile as Bh}from"fs/promises";import{join as Ii,relative as jh,resolve as _e}from"path";var Et,Gr,Ll=y(()=>{Et=A(J(),1);Yt();Y();b();vt();Ti();Pe();Mi();Gr=class{constructor(e){this.plasmoManifest=e}#i={};#o={};get projectPath(){return this.plasmoManifest.projectPath}get commonPath(){return this.plasmoManifest.commonPath}get mountExt(){return this.plasmoManifest.mountExt}async init(){let[e,...r]=await Promise.all([this.#n(),this.#t("popup"),this.#t("options"),this.#t("newtab"),this.#t("devtools"),this.#t("sidepanel")]);return r}#n=async()=>{let e=_e(this.plasmoManifest.templatePath.staticTemplatePath,"common"),r=_e(this.commonPath.staticDirectory,"common");return(0,Et.copy)(e,r)};#t=async e=>{d(`Creating static templates for ${e}`);let r=this.projectPath[`${e}IndexList`],n=this.projectPath[`${e}HtmlList`],[i,o]=await Promise.all([r,n].map(c=>Te(c,F))),{staticDirectory:s}=this.commonPath;await(0,Et.ensureDir)(s);let a=i!==void 0,l=a?ae(jh(s,i)):`~${e}`,u=_e(s,`${e}${this.mountExt}`);return await Promise.all([this.#e(`index${this.mountExt}`,u,{__plasmo_import_module__:l}),this.createPageHtml(e,o)]),a};generateHtml=async(e="",r="",n="")=>{let i={__plasmo_static_index_title__:this.plasmoManifest.name,__plasmo_static_script__:r};return await sr(n)?this.#r(n,e,{...i,"</body>":`<div id="__plasmo"></div><script src="${r}" type="module"></script></body>`}):this.#e("index.html",e,i)};createPageHtml=async(e,r="")=>{let n=_e(this.commonPath.dotPlasmoDirectory,`${e}.html`),i=`./static/${e}${this.mountExt}`;return this.generateHtml(n,i,r)};createPageMount=async e=>{d(`Creating page mount template for ${e.dir}`);let r=_e(this.commonPath.dotPlasmoDirectory,e.dir),n=_e(r,`${e.name}.html`);await(0,Et.ensureDir)(r);let i=bl(e.ext),o=_e(r,`${e.name}${this.mountExt}`),s=_e(this.commonPath.sourceDirectory,e.dir,`${e.name}.html`),a=await Promise.all(i?[this.#e(`index${this.mountExt}`,o,{__plasmo_import_module__:`~${ae(Ii(e.dir,e.name))}`}),this.generateHtml(n,`./${e.name}${this.mountExt}`,s)]:[this.generateHtml(n,`~${ae(Ii(e.dir,e.name))}${e.ext}`,s)]);return{htmlPath:n,wereFilesWritten:a.some(l=>l)}};createContentScriptMount=async e=>{d(`Creating content script mount for ${e.dir}`);let r=_e(this.commonPath.staticDirectory,e.dir);await(0,Et.ensureDir)(r);let n=_e(r,`${e.name}${this.mountExt}`);return await this.#e(`content-script-ui-mount${this.mountExt}`,n,{__plasmo_mount_content_script__:`~${ae(Ii(e.dir,e.name))}`}),n};#s=async(e,r,n)=>{let i=Object.entries(n).reduce((s,[a,l])=>s.replaceAll(a,l),e),o=Hr(Buffer.from(i));return this.#o[r]===o?!1:(this.#o[r]=o,await Bh(r,i),!0)};#r=async(e,r,n)=>{let i=await Ol(e,"utf8");return this.#s(i,r,n)};#e=async(e,r,n)=>(this.#i[e]||=await Ol(_e(this.plasmoManifest.staticScaffoldPath,e),"utf8"),this.#s(this.#i[e],r,n))}});import{ok as Me}from"assert";import{readdir as Nl}from"fs/promises";import{basename as Uh,dirname as qh,extname as Tl,isAbsolute as Wh,join as Vh,parse as Ml,relative as Jr,resolve as it}from"path";import{cwd as Hh}from"process";import Gh from"fast-glob";import{hasher as Jh}from"node-object-hash";var ce,Zt,zh,Yh,Pt,Pe=y(()=>{ce=A(J(),1);pi();Jt();an();Y();b();vt();vi();Si();ar();al();bi();ki();Mn();yl();Li();Qt();vl();Ll();Mi();Zt={16:"./gen-assets/icon16.plasmo.png",32:"./gen-assets/icon32.plasmo.png",48:"./gen-assets/icon48.plasmo.png",64:"./gen-assets/icon64.plasmo.png",128:"./gen-assets/icon128.plasmo.png"},zh=["storage"],Yh=Jh({trim:!0,sort:!0}),Pt=class{constructor(e){this.bundleConfig=e;this.data.icons=Zt,this.scaffolder=new Gr(this)}get browser(){return this.bundleConfig.browser}#i;get commonPath(){return mi(this.#i)}#o;get projectPath(){return mi(this.#o)}templatePath=vr();#n;get combinedEnv(){return Me(this.#n),this.#n.combinedEnv}get publicEnv(){return Me(this.#n),this.#n.plasmoPublicEnv}#t=new Set([".ts",".js"]);#s=new Set;#r;get uiLibrary(){return Me(this.#r),this.#r.uiLibrary}get mountExt(){return Me(this.#r),this.#r.uiExtMap.mountExt}get uiExts(){return Me(this.#r),this.#r.uiExtMap.uiExts}#e="";#a="";data={};overideManifest={};packageData;contentScriptMap=new Map;get mainWorldScriptList(){let e=[];for(let r of this.contentScriptMap.values())r.world==="MAIN"&&e.push(r);return e}get hasMainWorldScript(){for(let e of this.contentScriptMap.values())if(e.world==="MAIN")return!0;return!1}copyMap=new Map;permissionSet=new Set;scaffolder;get changed(){return this.#e!==this.#a}get name(){return Me(this.packageData),this.packageData.displayName}get dependencies(){return Me(this.packageData),this.packageData.dependencies}get devDependencies(){return Me(this.packageData),this.packageData.devDependencies}get staticScaffoldPath(){return Me(this.uiLibrary),it(this.templatePath.staticTemplatePath,this.uiLibrary.path)}async initEnv(e=Hh()){this.#n=await rl(e),this.#i=at(e)}async startup(){await this.initEnv(),d(`Ensure exists: ${this.commonPath.dotPlasmoDirectory}`),await(0,ce.ensureDir)(this.commonPath.dotPlasmoDirectory),await _l(this.commonPath),await wl(this.commonPath),await Br(this.commonPath),await gl(this.commonPath),await this.updateEnv(),await this.updatePackageData()}async postBuild(){await Promise.all(Array.from(this.copyMap,async([e,r])=>{await or(e)||await(0,ce.copy)(r,e)}))}async updateEnv(){await this.initEnv(this.commonPath.projectDirectory),await il(this)}prefixDev=(e="")=>process.env.NODE_ENV==="development"?`DEV | ${e}`:e;async updatePackageData(){if(this.packageData=await(0,ce.readJson)(this.commonPath.packageFilePath),!this.packageData)throw new Error("Invalid package.json");this.data.version=this.packageData.version,this.data.author=this.packageData.author,this.data.name=this.prefixDev(this.packageData.displayName),this.data.description=this.packageData.description,this.packageData.homepage&&(this.data.homepage_url=this.packageData.homepage);for(let e of zh)`@plasmohq/${e}`in(this.packageData.dependencies||{})&&this.permissionSet.add(e);await this.#c(),this.overideManifest=await this.#l()}#c=async()=>{let e=await kl(this),r=Cl(e.name);this.#r={uiLibrary:e,uiExtMap:r},this.#s=new Set(r.uiExts),this.uiExts.forEach(n=>{this.#t.add(n)}),this.#o=ul(this.commonPath,this.browser,this.uiExts)};toggleOptions=(e=!1)=>(e?this.data.options_ui={page:"./options.html",open_in_tab:!0}:delete this.data.options_ui,this);toggleOverrides=(e,r=!1)=>(r?this.data.chrome_url_overrides={...this.data.chrome_url_overrides,[e]:`./${e}.html`}:delete this.data.chrome_url_overrides?.[e],this);toggleNewtab=(e=!1)=>this.toggleOverrides("newtab",e);toggleDevtools=(e=!1)=>(e?this.data.devtools_page="./devtools.html":delete this.data.devtools_page,this);isPathInvalid=e=>{if(e===void 0)return!0;let r=Tl(e);if(!this.#t.has(r))return!0;let n=Zc(e);return!!(n.length>0&&n!==`.${this.browser}`||n.length===0&&(0,ce.existsSync)(e.replace(r,`.${this.browser}${r}`)))};toggleContentScript=async(e,r=!1)=>{if(this.isPathInvalid(e))return!1;if(r){let n=await sl(e);if(n?.isEmpty)return!1;d("Adding content script: ",e);let i=Jr(this.commonPath.dotPlasmoDirectory,e),o=Tl(i),s=this.#s.has(o);if(this.uiLibrary?.name!=="vanilla"&&s){let l=Vh("lab",i).replace(/(^src)[\\/]/,""),u=Ml(l);i=Jr(this.commonPath.dotPlasmoDirectory,await this.scaffolder.createContentScriptMount(u))}n?.config?.css&&n.config.css.length>0&&(n.config.css=n.config.css.map(l=>Jr(this.commonPath.dotPlasmoDirectory,it(qh(e),l))));let a=this.injectEnvToObj({matches:["<all_urls>"],js:[n?.config?.world==="MAIN"?i.split(o)[0]:i],...n?.config||{}});this.contentScriptMap.set(e,a)}else this.contentScriptMap.delete(e);return qc("cs_changed"),r};addDirectory=async(e,r,n)=>(0,ce.existsSync)(e)?Nl(e,{withFileTypes:!0}).then(i=>Promise.all(i.filter(o=>o.isFile()&&n?n(o.name):!0).map(o=>it(e,o.name)).map(o=>r(o,!0)))).then(i=>i.includes(!0)):!1;addContentScriptsIndexFiles=async()=>{let e=this.projectPath.contentsDirectory;if(!await Xi(e))return!1;let r=[...this.#t].flatMap(n=>[`index${n}`,`index.${this.browser}${n}`]);return Nl(e,{withFileTypes:!0}).then(n=>Promise.all(n.filter(i=>i.isDirectory()).map(i=>it(e,i.name)).map(i=>this.addDirectory(i,this.toggleContentScript,o=>r.includes(o))))).then(n=>n.includes(!0))};addContentScriptsDirectory=async(e=this.projectPath.contentsDirectory)=>Promise.all([this.addDirectory(e,this.toggleContentScript),this.addContentScriptsIndexFiles()]).then(r=>r.includes(!0));togglePage=async(e,r=!1)=>{if(this.isPathInvalid(e))return!1;if(r){let n=Jr(this.commonPath.sourceDirectory,e),i=Ml(n),{wereFilesWritten:o}=await this.scaffolder.createPageMount(i);o&&(this.#e="")}else this.#e="";return r};addPagesDirectory=async e=>this.addDirectory(e,this.togglePage);write=(e=!1)=>{this.#a=this.#e;let r=this.toJSON();if(this.#e=Yh.hash(r),!(!this.changed&&!e))return d("Hash changed, updating manifest"),(0,ce.writeJson)(this.commonPath.entryManifestPath,r,{spaces:2})};toJSON=()=>{let e={...this.data},{options_ui:r,permissions:n,content_scripts:i,background:o,...s}=this.overideManifest;return e.options_ui?.page&&(e.options_ui={...e.options_ui,...r}),e.permissions=[...new Set([...this.permissionSet,...n||[]])],e.permissions?.length===0&&delete e.permissions,this.bundleConfig.manifestVersion==="mv2"&&(e.background={...e.background,...o},Object.keys(e.background).length===0&&delete e.background,s.host_permissions?.length>0&&(e.permissions=[...e.permissions||[],...s.host_permissions])),e.content_scripts=[...Array.from(this.contentScriptMap.values()).filter(a=>a.world!=="MAIN"),...i||[]],e.content_scripts.length===0&&delete e.content_scripts,{...e,...s}};#l=async()=>{if(!this.packageData?.manifest)return{};let e=await this.prepareOverrideManifest();if((e.web_accessible_resources?.length||0)>0&&(e.web_accessible_resources=await this.resolveWAR(this.packageData.manifest.web_accessible_resources)),e.browser_specific_settings)switch(this.browser){case"edge":case"safari":e.browser_specific_settings={[this.browser]:e.browser_specific_settings[this.browser]};break;case"firefox":case"gecko":e.browser_specific_settings={gecko:e.browser_specific_settings.gecko};break;default:delete e.browser_specific_settings}return this.injectEnvToObj(e)};copyProjectFile=async e=>{try{if(e.startsWith("~"))return this.copyProjectFile(e.slice(1));if(e.includes("*")){let o=await Gh(e,{cwd:this.commonPath.projectDirectory,onlyFiles:!0});return await Promise.all(o.map(this.copyProjectFile)),e}let r=Wh(e)?e:it(this.commonPath.projectDirectory,e);if(!(!this.projectPath.isEntryPath(r)&&await(0,ce.pathExists)(r)))return e;let i=it(this.commonPath.distDirectory,e);return this.copyMap.set(i,r),ae(e)}catch{return e}};copyNodeModuleFile=async e=>{try{let r=v.resolve(e,{paths:[this.commonPath.projectDirectory]}),n=Uh(r),i=it(this.commonPath.distDirectory,n);return this.copyMap.set(i,r),n}catch{return null}};injectEnvToObj=e=>Vr(e,r=>typeof r!="string"?r:r.match(/^\$(\w+)$/)?this.combinedEnv[r.substring(1)]||void 0:ji(r,this.combinedEnv))}});import{relative as Kh,resolve as Il}from"path";var zr,Dl,Fl=y(()=>{zr=A(J(),1);b();vt();Pe();Dl=async({indexFilePath:t="",withMessaging:e=!1,withMainWorldScript:r=!1},n)=>{d("Creating BGSW entry");let i=Il(n.commonPath.staticDirectory,"background"),o=Il(i,"index.ts"),s=Kh(i,t),a=[e&&'import "./messaging"',t&&`import "${ae(s).slice(0,-3)}"`,r&&'import "./main-world-scripts"'].filter(Boolean).join(`
`);await(0,zr.ensureDir)(i),await(0,zr.outputFile)(o,a)}});import{relative as Xh,resolve as Qh}from"path";import{camelCase as Al}from"change-case";var Rl,$l,Bl=y(()=>{Rl=A(J(),1);b();vt();Pe();$l=async t=>{try{let e=Qh(t.commonPath.staticDirectory,"background","main-world-scripts.ts"),r=t.mainWorldScriptList.map(i=>{let o=i.js.map(c=>{let f=Al(c),p=`url:${ae(Xh(t.commonPath.entryManifestPath,c))}`;return{importName:f,importPath:p}}),s=o.map(c=>`import ${c.importName} from "${c.importPath}"`).join(`
`),a=o.map(c=>c.importName),l=Object.entries(i).reduce((c,[f,p])=>(f!=="js"&&(c[Al(f)]=p),c),{id:a.join("-"),js:[]}),u=JSON.stringify(l).replace(/"js":\[\]/,`"js":[${a.map(c=>`${c}.split("/").pop().split("?")[0]`).join(",")}]`);return[s,u]});if(r.length===0)return!1;t.permissionSet.add("scripting");let n=`${r.map(([i])=>i).join(`
`)}
chrome.scripting.registerContentScripts([
  ${r.map(([,i])=>i).join(`,
  `)}
]).catch(_ => {})
`;return await(0,Rl.outputFile)(e,n),!0}catch(e){return d(e.message),!1}}});import{join as Zh,resolve as eg}from"path";import{camelCase as tg}from"change-case";import rg from"fast-glob";var ql,jl,ng,Ul,ig,og,Wl,Vl=y(()=>{ql=A(J(),1);Y();b();vt();Oi();Ti();Pe();jl={md5Hash:""},ng=(t,e,r)=>`// @ts-nocheck
globalThis.__plasmoInternalPortMap = new Map()

${t}

chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  switch (request.name) {
    ${e}
    default:
      break
  }

  return true
})

chrome.runtime.onConnect.addListener(function(port) {
  globalThis.__plasmoInternalPortMap.set(port.name, port)
  port.onMessage.addListener(function(request) {
    switch (port.name) {
      ${r}
      default:
        break
    }
  })
})

`,Ul=async(t,e)=>{let r=Zh(t.projectPath.backgroundDirectory,e);return await ir(r)?(await rg("**/*.ts",{cwd:r,onlyFiles:!0})).map(i=>{let s=ae(i).slice(0,-3),a=`${e}/${s}`,l=tg(a);return{importName:l,name:s,declaration:`"${s}" : {}`,importCode:`import { default as ${l} } from "~background/${a}"`}}):[]},ig=(t,e)=>`case "${t}":
  ${e}({
    sender,
    ...request
  }, {
    send: (p) => sendResponse(p)
  })
  break`,og=(t,e)=>`case "${t}":
  ${e}({
    port,
    ...request
  }, {
    send: (p) => port.postMessage(p)
  })
  break`,Wl=async t=>{try{let[e,r]=await Promise.all([Ul(t,"messages"),Ul(t,"ports")]);if(d({messageHandlerList:e,portHandlerList:r}),e.length===0&&r.length===0)return!1;if(!("@plasmohq/messaging"in t.dependencies))return Z("@plasmohq/messaging is not installed, skipping messaging API"),!1;let n=ml(e.map(({declaration:s})=>s),r.map(({declaration:s})=>s)),i=Hr(Buffer.from(n));if(jl.md5Hash===i)return!0;jl.md5Hash=i;let o=ng([...e,...r].map(s=>s.importCode).join(`
`),e.map(s=>ig(s.name,s.importName)).join(`
`),r.map(s=>og(s.name,s.importName)).join(`
`));return await Promise.all([(0,ql.outputFile)(eg(t.commonPath.staticDirectory,"background","messaging.ts"),o),pl(t.commonPath,n)]),!0}catch(e){return d(e.message),!1}}});var er,Di=y(()=>{Yt();Y();Fl();Bl();Vl();Pe();er=async t=>{let[e,r,n]=await Promise.all([Te(t.projectPath.backgroundIndexList,F),Wl(t),$l(t)]),i=!!e||r||n;return i&&await Dl({indexFilePath:e,withMessaging:r,withMainWorldScript:n},t),t.toggleBackground(i)}});import{subscribe as sg}from"@parcel/watcher";var ag,Hl,cg,Gl=y(()=>{Xc();Jt();pe();b();Di();Pe();bi();ki();ag=["node_modules","build",".plasmo","coverage",".git"],Hl=async t=>{if($("--impulse"))return null;let{default:e}=await import("is-path-inside"),{knownPathSet:r,watchPathReasonMap:n,watchDirectoryEntries:i}=t.projectPath;d("Watching the following files:",r);let o=s=>{if(r.has(s))return n[s];let a=i.find(([,l])=>e(s,l));return a?(r.add(s),n[s]=a[0]):0};return sg(t.commonPath.projectDirectory,async(s,a)=>{if(s)throw s;await Promise.all(a.map(({path:l,type:u})=>cg(u,l,o(l),t))),await t.write()},{backend:Kc,ignore:ag})},cg=async(t,e,r,n)=>{let i=t!=="delete";switch(r){case 0:return;case 1:{Z("Environment file change detected, please restart the dev server."),await n.updateEnv();return}case 3:{M("Assets directory changed, update dynamic assets"),await Br(n.commonPath);return}case 2:{M("package.json changed, updating manifest overides. You might need to restart the dev server."),await n.updatePackageData();return}case 6:case 5:{await er(n);return}case 7:case 8:{await n.toggleContentScript(e,i),n.hasMainWorldScript&&await er(n);return}case 19:case 20:case 4:{await n.togglePage(e,i);return}case 11:{n.toggleSidePanel(i);return}case 15:{n.togglePopup(i);return}case 17:{n.toggleOptions(i);return}case 13:{n.toggleDevtools(i);return}case 9:{n.toggleNewtab(i);return}case 16:{await n.scaffolder.createPageHtml("popup",i&&e);return}case 18:{await n.scaffolder.createPageHtml("options",i&&e);return}case 14:{await n.scaffolder.createPageHtml("devtools",i&&e);return}case 10:{await n.scaffolder.createPageHtml("newtab",i&&e);return}case 12:{await n.scaffolder.createPageHtml("sidepanel",i&&e);return}default:wt(r)}}});import{dirname as lg,join as ug,resolve as fg}from"path";import pg from"@parcel/fs";import Yr from"@parcel/package-manager";import{Parcel as mg}from"@plasmohq/parcel-core";var Je,dg,Kr,Fi=y(()=>{Je=A(J(),1);pe();cr();dg={npm:Yr.Npm,yarn:Yr.Yarn,pnpm:Yr.Pnpm},Kr=async({commonPath:t,bundleConfig:e,publicEnv:r},{defaultTargetOptions:n={},...i})=>{let o=i.mode==="production";o?await(0,Je.emptyDir)(t.distDirectory):await(0,Je.ensureDir)(t.distDirectory),process.env.__PLASMO_FRAMEWORK_INTERNAL_NO_MINIFY=o&&$("--no-minify")?"true":"false",process.env.__PLASMO_FRAMEWORK_INTERNAL_SOURCE_MAPS=o?$("--inline-source-maps")?"inline":$("--source-maps")?"external":"none":$("--no-source-maps")?"none":"inline",process.env.__PLASMO_FRAMEWORK_INTERNAL_NO_CS_RELOAD=$("--no-cs-reload")?"true":"false",process.env.__PLASMO_FRAMEWORK_INTERNAL_ES_TARGET=H("--es-target")||"es2022";let s=await ct(),a=new pg.NodeFS,l=dg[s.name],u=new Yr.NodePackageManager(a,t.projectDirectory,new l),c=v.resolve("@plasmohq/parcel-config"),f=ug(lg(c),"run.json"),p=await(0,Je.readJson)(c);$("--bundle-buddy")&&(p.reporters=["...","@parcel/reporter-bundle-buddy"]),await(0,Je.writeJson)(f,p);let m={browsers:e.manifestVersion==="mv2"&&e.browser!=="firefox"?["IE 11"]:["last 1 Chrome version"]};return new mg({inputFS:a,packageManager:u,entries:t.entryManifestPath,cacheDir:fg(t.cacheDirectory,"parcel"),config:f,shouldAutoInstall:!0,env:r.extends(e).data,defaultTargetOptions:{...n,engines:m,sourceMaps:process.env.__PLASMO_FRAMEWORK_INTERNAL_SOURCE_MAPS!=="none",distDir:t.distDirectory},...i})}});var Xr,Jl=y(()=>{b();Pe();Xr=class extends Pt{constructor(e){super(e),this.data.manifest_version=2,this.data.browser_action={default_icon:Zt}}toggleSidePanel=(e=!1)=>{switch(this.browser){case"firefox":case"gecko":{e?this.data.sidebar_action={default_panel:"./sidepanel.html"}:delete this.data.sidebar_action;break}default:M("SidePanel is not available on chromium-based MV2 browsers, skipping.")}return this};togglePopup=(e=!1)=>(e?this.data.browser_action.default_popup="./popup.html":delete this.data.browser_action.default_popup,this);toggleBackground=(e=!1)=>(e?this.data.background={scripts:["./static/background/index.ts"]}:delete this.data.background,e);prepareOverrideManifest=()=>{let{manifest:e}=this.packageData,r={...e};return r.permissions=[...e.permissions||[],...e.host_permissions||[]],"host_permissions"in r&&delete r.host_permissions,"content_security_policy"in e&&(r.content_security_policy=e.content_security_policy?.extension_pages),r};resolveWAR=e=>Promise.all(e.map(async({resources:r})=>(await Promise.all(r.map(async i=>await this.copyNodeModuleFile(i)||await this.copyProjectFile(i)))).flat())).then(r=>r.flat())}});var Qr,zl=y(()=>{Pe();Qr=class extends Pt{constructor(e){super(e),this.data.manifest_version=3,this.data.action={default_icon:Zt}}toggleSidePanel=(e=!1)=>{switch(this.browser){case"firefox":case"gecko":{e?this.data.sidebar_action={default_panel:"./sidepanel.html"}:delete this.data.sidebar_action;break}default:e?(this.data.side_panel={default_path:"./sidepanel.html"},this.permissionSet.add("sidePanel")):(delete this.data.side_panel,this.permissionSet.delete("sidePanel"))}return this};togglePopup=(e=!1)=>(e?this.data.action.default_popup="./popup.html":delete this.data.action.default_popup,this);toggleBackground=(e=!1)=>(e?this.data.background={service_worker:"./static/background/index.ts"}:delete this.data.background,e);prepareOverrideManifest=()=>({...this.packageData.manifest});resolveWAR=e=>Promise.all(e.map(async({resources:r,...n})=>({resources:(await Promise.all(r.map(async o=>await this.copyNodeModuleFile(o)||await this.copyProjectFile(o)))).flat(),...n})))}});async function bt(t){d("Creating Manifest Factory...");let e=t.manifestVersion==="mv3"?new Qr(t):new Xr(t);await e.startup();let{contentIndexList:r,sandboxIndexList:n,tabsDirectory:i,sandboxesDirectory:o}=e.projectPath,[s,a]=await Promise.all([r,n].map(g=>Te(g,F))),l=await Promise.all([e.scaffolder.init(),e.togglePage(a,!0),e.toggleContentScript(s,!0),e.addContentScriptsDirectory(),e.addPagesDirectory(i),e.addPagesDirectory(o)]);l.push(await er(e));let u=l.flat();u.includes(!0)||Z("Unable to find any entry files. The extension might be empty");let[c,f,p,m,h]=u;return e.togglePopup(c).toggleOptions(f).toggleNewtab(p).toggleDevtools(m).toggleSidePanel(h),await e.write(!0),e}var Zr=y(()=>{Yt();Y();b();Di();Jl();zl()});var Yl={};Ke(Yl,{default:()=>gg});async function hg(){ue(),await St(),process.env.NODE_ENV="development";let t=H("--serve-port")||"1012",e=H("--serve-host")||"localhost",r=H("--hmr-port")||"1815",n=H("--hmr-host")||"localhost";M("Starting the extension development server...");let{default:i}=await import("get-port"),[o,s]=await Promise.all([i({port:parseInt(t)}),i({port:parseInt(r)})]),a=fi(n,s);d(`Starting dev server on ${e}:${o}, HMR on ${n}:${s}...`);let l=_t(),u=await bt(l),c=await Hl(u),f=await Kr(u,{logLevel:"verbose",shouldBundleIncrementally:!0,serveOptions:{host:e,port:o},hmrOptions:{host:n,port:s}}),{default:p}=await import("chalk"),m=await f.watch(async(g,_)=>{if(g)throw g;_!==void 0&&(_.type==="buildSuccess"?(De(`Extension re-packaged in ${p.bold(_.buildTime)}ms! \u{1F680}`),await u.postBuild(),a.broadcast("build_ready")):_.type==="buildFailure"&&(kt()||le(p.redBright(`Build failed. To debug, run ${p.bold("plasmo dev --verbose")}.`)),_.diagnostics.forEach(S=>{le(p.redBright(S.message)),S.stack&&d(S.stack),S.hints?.forEach(C=>{d(C)}),S.codeFrames?.forEach(C=>{C.code&&d(C.code),C.codeHighlights.forEach(O=>{O.message&&d(O.message),d(p.underline(`${C.filePath}:${O.start.line}:${O.start.column}`))})})})),process.env.__PLASMO_FRAMEWORK_INTERNAL_WATCHER_STARTED="true")}),h=()=>{c?.unsubscribe(),m.unsubscribe()};process.on("SIGINT",h),process.on("SIGTERM",h)}var gg,Kl=y(()=>{pi();pe();b();Fr();Gl();Qt();Fi();Xe();Zr();gg=hg});import{readdir as yg,readFile as _g,rename as Xl,stat as wg,writeFile as vg}from"fs/promises";import{join as xg,resolve as Sg}from"path";var Eg,Ai,Ql=y(()=>{Eg=async t=>{let r=(await _g(Sg(t),"utf8")).replace(/\/_/g,"/");await vg(t,r,"utf8")},Ai=async(t="")=>{let e=await yg(t);for(let r of e){let n=xg(t,r);if((await wg(n)).isDirectory()){let o=n.replace("/_","/");await Xl(n,o),await Ai(o)}else{let o=n.replace("/_","/");await Xl(n,o),await Eg(o)}}}});import{mkdir as Pg}from"fs/promises";import{resolve as Ri}from"path";import{sentenceCase as bg}from"change-case";var ze,kg,Zl,eu=y(()=>{ze=A(J(),1);Y();b();ar();Ql();kg=t=>({name:bg(t.name),description:t.description,version:t.version,manifest_version:3,chrome_url_overrides:{newtab:"./index.html"}}),Zl=async()=>{let{projectDirectory:t,packageFilePath:e}=at();d("Creating a Plasmo + Nextjs based new tab extension");let r=Ri(t,"out"),{default:n}=await import("chalk");if(!await F(r))throw new Error(`${n.bold("out")} directory does not exist, did you forget to run "${n.underline("next build && next export")}"?`);let i=await(0,ze.readJson)(e),o=Ri(t,"extension");if(await F(o)){let{default:{prompt:s}}=await import("inquirer"),{answer:a}=await s({type:"confirm",name:"answer",message:`${n.bold("extension")} directory already exists, do you want to overwrite it?`});if(!a)throw new Error("Aborted");await(0,ze.emptyDir)(o)}await Pg(o),await(0,ze.copy)(r,o),d("Extension created at:",o),await Ai(o),await(0,ze.writeJson)(Ri(o,"manifest.json"),kg(i),{spaces:2}),De("Your extension is ready in the extension/ directory")}});import{createReadStream as Cg,createWriteStream as Og}from"fs";import{resolve as tu}from"path";import Lg from"fast-glob";import{AsyncZipDeflate as Ng,Zip as Tg}from"fflate";function Mg(t){return t/1024/1024}var en,$i=y(()=>{b();en=async({distDirectory:t,buildDirectory:e,distDirectoryName:r},n=!1)=>{let i=tu(e,`${r}.zip`),o=Og(i),s=await Lg(["**/*",!n&&"!**/(*.js.map|*.css.map)"].filter(Boolean),{cwd:t,onlyFiles:!0});return new Promise((a,l)=>{let u=0,c=!1,f=Date.now(),p=new Tg((m,h,g)=>{c||(m?l(m):(u+=h.length,o.write(h),g&&(M(`Zip Package size: ${Mg(u).toFixed(2)} MB in ${Date.now()-f}ms`),o.end(),a())))});for(let m of s){if(c)return;let h=new Ng(m,{level:9});p.add(h);let g=tu(t,m);Cg(g).on("data",_=>{h.push(_,!1)}).on("end",()=>{h.push(new Uint8Array(0),!0)}).on("error",_=>{c=!0,p.terminate(),l(`Error reading file ${g}: ${_.message}`)})}p.end()})}});var ru={};Ke(ru,{default:()=>Dg});async function Ig(){ue(),await St(),process.env.NODE_ENV="production";let[t]=tr("build");if(t==="next-new-tab"){await Zl();return}M("Prepare to bundle the extension...");let e=_t(),r=await bt(e),i=await(await Kr(r,{mode:"production",shouldDisableCache:!0,shouldContentHash:!1,defaultTargetOptions:{shouldOptimize:!0,shouldScopeHoist:$("--hoist")}})).run();De(`Finished in ${i.buildTime}ms!`),await r.postBuild(),$("--zip")&&await en(r.commonPath)}var Dg,nu=y(()=>{rr();pe();b();Fr();eu();Qt();Fi();Xe();Zr();$i();Dg=Ig});var iu={};Ke(iu,{default:()=>Ag});async function Fg(){ue(),await St(),process.env.NODE_ENV="production",M("Prepare to package the extension bundle...");let t=_t(),e=await bt(t);await en(e.commonPath,$("--with-source-maps"))}var Ag,ou=y(()=>{pe();b();Fr();Qt();Xe();Zr();$i();Ag=Fg});var tn={};Ke(tn,{default:()=>$g});async function Rg(){console.log("0.83.0")}var $g,rn=y(()=>{$g=Rg});var nn,cn,su,ln=y(()=>{nn={help:()=>Promise.resolve().then(()=>(Ji(),Gi)),start:()=>Promise.resolve().then(()=>(Yi(),zi)),init:()=>Promise.resolve().then(()=>(ha(),da)),dev:()=>Promise.resolve().then(()=>(Kl(),Yl)),build:()=>Promise.resolve().then(()=>(nu(),ru)),package:()=>Promise.resolve().then(()=>(ou(),iu)),version:()=>Promise.resolve().then(()=>(rn(),tn)),"-v":()=>Promise.resolve().then(()=>(rn(),tn)),"--version":()=>Promise.resolve().then(()=>(rn(),tn))},cn=Object.keys(nn),su=new Set(cn)});import{argv as au,exit as Bi,versions as Bg}from"process";import jg from"semver";pe();b();b();import{stdout as Wi}from"process";var _u=t=>new Promise(e=>setTimeout(e,t));async function Vi(t){for(let e=t;e>0;e--)Wi.write(`${"\u{1F534} EXIT".padEnd(9)} | This program will terminate in ${e} seconds...\r`),await _u(1e3);Wi?.clearLine(0),ve("\u{1F534} EXIT","\u{1F44B} Good bye and have a great day!")}ln();Xe();async function Ug(){ue(),nr()}async function qg(){try{if(au.length>10)throw new Error("Too many arguments provided.");if(jg.major(Bg.node)<16)throw new Error("Node version must be >= 16");process.env.VERBOSE=Ui?"true":"false";let t=au.find(e=>su.has(e));if(t in nn){d("Running command:",t);let{default:e}=await nn[t]();await e()}else d("Running default mode"),await Ug()}catch(t){le(t.message||"Unknown error."),d(t.stack),await Vi(3),Bi(1)}}qg();process.on("SIGINT",()=>Bi(0));process.on("SIGTERM",()=>Bi(0));
